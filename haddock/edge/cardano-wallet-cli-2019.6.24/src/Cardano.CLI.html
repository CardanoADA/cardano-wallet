<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="">{-# LANGUAGE DataKinds #-}
{-# LANGUAGE DeriveGeneric #-}
{-# LANGUAGE DerivingStrategies #-}
{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE GeneralizedNewtypeDeriving #-}
{-# LANGUAGE KindSignatures #-}
{-# LANGUAGE LambdaCase #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE RankNTypes #-}
{-# LANGUAGE RecordWildCards #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TypeApplications #-}
{-# LANGUAGE TypeOperators #-}

-- |
-- Copyright: &#169; 2018-2019 IOHK
-- License: MIT
--
-- Shared types and helpers for CLI parsing

module Cardano.CLI
    (
    -- * Environment
      Environment (..)

    -- * CLI Construction
    , makeCli

    -- * CLI Execution
    , runCli
    , runCliCommand

    -- * Launch Support
    , execLaunchCommands
    , commandWalletServe
    , parseWalletListen
    , setupStateDir

    -- * Types
    , Port (..)

    -- * Logging
    , Verbosity (..)
    , initTracer
    , minSeverityFromArgs
    , verbosityFromArgs
    , verbosityToArgs
    , verbosityToMinSeverity

    -- * Mnemonics
    , execGenerateMnemonic

    -- * Unicode Terminal Helpers
    , setUtf8Encoding

    -- * ANSI Terminal Helpers
    , putErrLn
    , hPutErrLn

    -- * Parsing Arguments
    , OptionValue (..)
    , optional
    , parseArgWith
    , parseAllArgsWith
    , help

    -- * Working with Sensitive Data
    , getLine
    , hGetLine
    , getSensitiveLine
    , hGetSensitiveLine

    -- * Helpers
    , decodeError
    , showT
    ) where

import Prelude hiding
    ( getLine )

import Cardano.BM.Configuration.Static
    ( defaultConfigStdout )
import Cardano.BM.Data.Severity
    ( Severity (..) )
import Cardano.BM.Setup
    ( setupTrace )
import Cardano.BM.Trace
    ( Trace, appendName, logAlert, logInfo )
import Cardano.Launcher
    ( Command (Command)
    , ProcessHasExited (ProcessHasExited)
    , StdStream (..)
    , installSignalHandlers
    , launch
    )
import Cardano.Wallet.Api
    ( Api )
import Cardano.Wallet.Api.Server
    ( Listen (..) )
import Cardano.Wallet.Api.Types
    ( ApiMnemonicT (..)
    , ApiT (..)
    , PostTransactionData (..)
    , WalletPostData (..)
    , WalletPutData (..)
    )
import Cardano.Wallet.Primitive.AddressDerivation
    ( FromMnemonic (..), Passphrase (..) )
import Cardano.Wallet.Primitive.Mnemonic
    ( entropyToMnemonic, genEntropy, mnemonicToText )
import Cardano.Wallet.Primitive.Types
    ( DecodeAddress, EncodeAddress, Hash (..) )
import Cardano.Wallet.Version
    ( showVersion, version )
import Control.Arrow
    ( first, second )
import Control.Concurrent
    ( threadDelay )
import Control.Exception
    ( bracket )
import Control.Monad
    ( unless, when )
import Data.Aeson
    ( (.:) )
import Data.Bifunctor
    ( bimap )
import Data.Either
    ( fromRight, isRight )
import Data.Functor
    ( (&lt;$), (&lt;&amp;&gt;) )
import Data.List
    ( sort )
import Data.Maybe
    ( fromMaybe )
import Data.Proxy
    ( Proxy (..) )
import Data.Text
    ( Text )
import Data.Text.Class
    ( CaseStyle (..)
    , FromText (..)
    , TextDecodingError (..)
    , ToText (..)
    , fromTextToBoundedEnum
    , toTextFromBoundedEnum
    )
import Data.Text.Read
    ( decimal )
import Fmt
    ( Buildable, blockListF, fmt, nameF, pretty )
import GHC.Generics
    ( Generic )
import GHC.TypeLits
    ( Symbol )
import Network.HTTP.Client
    ( Manager, defaultManagerSettings, newManager )
import Servant
    ( (:&lt;|&gt;) (..), (:&gt;) )
import Servant.Client
    ( BaseUrl (..), ClientM, Scheme (..), client, mkClientEnv, runClientM )
import Servant.Client.Core
    ( ServantError (..), responseBody )
import System.Console.ANSI
    ( Color (..)
    , ColorIntensity (..)
    , ConsoleLayer (..)
    , SGR (..)
    , hCursorBackward
    , hSetSGR
    )
import System.Console.Docopt
    ( Arguments
    , Docopt
    , Option
    , argument
    , command
    , exitWithUsage
    , exitWithUsageMessage
    , getAllArgs
    , getArgOrExitWith
    , isPresent
    , longOption
    , parseArgsOrExit
    , shortOption
    , usage
    )
import System.Console.Docopt.NoTH
    ( parseUsage )
import System.Directory
    ( createDirectory, doesDirectoryExist )
import System.Environment
    ( getArgs )
import System.Exit
    ( exitFailure, exitSuccess, exitWith )
import System.FilePath
    ( (&lt;/&gt;) )
import System.IO
    ( BufferMode (..)
    , Handle
    , hGetBuffering
    , hGetChar
    , hGetEcho
    , hIsTerminalDevice
    , hPutChar
    , hSetBuffering
    , hSetEcho
    , hSetEncoding
    , stderr
    , stdin
    , stdout
    , utf8
    )
import Text.Heredoc
    ( here )

import qualified Cardano.BM.Configuration.Model as CM
import qualified Cardano.BM.Data.BackendKind as CM
import qualified Data.Aeson as Aeson
import qualified Data.Aeson.Encode.Pretty as Aeson
import qualified Data.Aeson.Types as Aeson
import qualified Data.ByteString.Lazy as BL
import qualified Data.ByteString.Lazy.Char8 as BL8
import qualified Data.List.NonEmpty as NE
import qualified Data.Text as T
import qualified Data.Text.Encoding as T
import qualified Data.Text.IO as TIO

{-------------------------------------------------------------------------------
                                Environment
-------------------------------------------------------------------------------}

-- | A convenient representation of a complete CLI environment.
data Environment = Environment
    { args
        :: Arguments
    , cli
        :: Docopt
    , argPresent
        :: Option -&gt; Bool
    , parseAllArgs
        :: forall a . FromText a =&gt; Option -&gt; IO (NE.NonEmpty a)
    , parseArg
        :: forall a . FromText a =&gt; Option -&gt; IO a
    , parseOptionalArg
        :: forall a . FromText a =&gt; Option -&gt; IO (Maybe a)
    }

{-------------------------------------------------------------------------------
                              CLI Construction
-------------------------------------------------------------------------------}

-- | Make a specialized CLI from the specified commands, options, and examples.
--
makeCli :: String -&gt; String -&gt; String -&gt; Docopt
makeCli cliCommandsSpecific cliOptionsSpecific cliExamplesSpecific =
    fromRight (error &quot;Unable to construct CLI.&quot;) $
        parseUsage usageString
  where
    usageString = mempty
        &lt;&gt; cliHeader
        &lt;&gt; &quot;\nUsage:\n&quot;
        &lt;&gt; cliCommands
        &lt;&gt; &quot;\nOptions:\n&quot;
        &lt;&gt; cliOptions
        &lt;&gt; &quot;\nExamples:\n&quot;
        &lt;&gt; cliExamples
    cliCommands = unlines $ filter (not . null) $ lines $ mempty
        &lt;&gt; cliCommandsSpecific
        &lt;&gt; cliCommandsGeneric
    cliOptions = unlines $ filter (not . null) $ sort $ lines $ mempty
        &lt;&gt; cliOptionsSpecific
        &lt;&gt; cliOptionsGeneric
    cliExamples = unlines $ filter (not . null) $ lines $ mempty
        &lt;&gt; cliExamplesSpecific
        &lt;&gt; cliExamplesGeneric

cliHeader :: String
cliHeader = [here|Cardano Wallet CLI.

The CLI is a proxy to the wallet server, which is required for most
commands. Commands are turned into corresponding API calls, and submitted
to an up-and-running server. Some commands do not require an active server
and can be run &quot;offline&quot;. (e.g. 'generate mnemonic')

    &#9888;&#65039;  Options are positional (--a --b is not equivalent to --b --a) ! &#9888;&#65039;
|]

cliCommandsGeneric :: String
cliCommandsGeneric = [here|
  cardano-wallet mnemonic generate [--size=INT]
  cardano-wallet wallet list [--port=INT]
  cardano-wallet wallet create [--port=INT] &lt;name&gt; [--address-pool-gap=INT]
  cardano-wallet wallet get [--port=INT] &lt;wallet-id&gt;
  cardano-wallet wallet update [--port=INT] &lt;wallet-id&gt; --name=STRING
  cardano-wallet wallet delete [--port=INT] &lt;wallet-id&gt;
  cardano-wallet transaction create [--port=INT] &lt;wallet-id&gt; --payment=PAYMENT...
  cardano-wallet address list [--port=INT] [--state=STRING] &lt;wallet-id&gt;
  cardano-wallet -h | --help
  cardano-wallet --version
|]

cliOptionsGeneric :: String
cliOptionsGeneric = [here|
  --address-pool-gap &lt;INT&gt;  number of unused consecutive addresses to keep track of [default: 20]
  --database &lt;FILE&gt;         use this file for storing wallet state
  --network &lt;STRING&gt;        testnet or mainnet [default: testnet]
  --payment &lt;PAYMENT&gt;       address to send to and amount to send separated by @: '&lt;amount&gt;@&lt;address&gt;'
  --port &lt;INT&gt;              port used for serving the wallet API [default: 8090]
  --quiet                   suppress all log output apart from errors
  --random-port             serve wallet API on any available port (conflicts with --port)
  --size &lt;INT&gt;              number of mnemonic words to generate [default: 15]
  --state &lt;STRING&gt;          address state: either used or unused
  --state-dir &lt;DIR&gt;         write wallet state (blockchain and database) to this directory
  --verbose                 display debugging information in the log output
|]

cliExamplesGeneric :: String
cliExamplesGeneric = [here|
</span><span class="hs-cpp">  # Create a transaction and send 22 lovelace from wallet-id to specified address
</span><span>  </span><span class="hs-identifier">cardano</span><span class="hs-glyph">-</span><span class="hs-identifier">wallet</span><span> </span><span class="hs-identifier">transaction</span><span> </span><span class="hs-identifier">create</span><span> </span><span class="hs-number">2512</span><span class="hs-identifier">a00e9653fe49a44a5886202e24d77eeb998f</span><span> </span><span class="hs-glyph">\</span><span>
</span><a name="line-322"></a><span>    </span><span class="hs-comment">--payment 22@Ae2tdPwUPEZ...nRtbfw6EHRv1D</span><span>
</span><a name="line-323"></a><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                              CLI Execution
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- | Runs a CLI with the specified backend and CLI definition.</span><span>
</span><a name="line-330"></a><span class="hs-identifier">runCli</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Manager</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cardano.CLI.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Docopt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><a name="runCli"><a href="Cardano.CLI.html#runCli"><span class="hs-identifier">runCli</span></a></a><span> </span><a name="local-6989586621679159566"><a href="#local-6989586621679159566"><span class="hs-identifier">withBackend</span></a></a><span> </span><a name="local-6989586621679159567"><a href="#local-6989586621679159567"><span class="hs-identifier">cliDefinition</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-332"></a><span>    </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-identifier hs-var">NoBuffering</span><span>
</span><a name="line-333"></a><span>    </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><span class="hs-identifier hs-var">NoBuffering</span><span>
</span><a name="line-334"></a><span>    </span><a href="Cardano.CLI.html#setUtf8Encoding"><span class="hs-identifier hs-var">setUtf8Encoding</span></a><span>
</span><a name="line-335"></a><span>    </span><a name="local-6989586621679160044"><a href="#local-6989586621679160044"><span class="hs-identifier">manager</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newManager</span><span> </span><span class="hs-identifier hs-var">defaultManagerSettings</span><span>
</span><a name="line-336"></a><span>    </span><a name="local-6989586621679160103"><a href="#local-6989586621679160103"><span class="hs-identifier">arguments</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getArgs</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">parseArgsOrExit</span><span> </span><a href="#local-6989586621679159567"><span class="hs-identifier hs-var">cliDefinition</span></a><span>
</span><a name="line-337"></a><span>    </span><a href="#local-6989586621679159566"><span class="hs-identifier hs-var">withBackend</span></a><span> </span><a href="#local-6989586621679160044"><span class="hs-identifier hs-var">manager</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Cardano.CLI.html#Environment"><span class="hs-identifier hs-var">Environment</span></a><span>
</span><a name="line-338"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">arguments</span></a><span>
</span><a name="line-339"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cli</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679159567"><span class="hs-identifier hs-var">cliDefinition</span></a><span>
</span><a name="line-340"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">argPresent</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPresent</span><span class="hs-special">`</span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parseAllArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#parseAllArgsWith"><span class="hs-identifier hs-var">parseAllArgsWith</span></a><span> </span><a href="#local-6989586621679159567"><span class="hs-identifier hs-var">cliDefinition</span></a><span> </span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">arguments</span></a><span>
</span><a name="line-342"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parseArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#parseArgWith"><span class="hs-identifier hs-var">parseArgWith</span></a><span> </span><a href="#local-6989586621679159567"><span class="hs-identifier hs-var">cliDefinition</span></a><span> </span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">arguments</span></a><span>
</span><a name="line-343"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parseOptionalArg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679160104"><a href="#local-6989586621679160104"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-344"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPresent</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679160104"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-345"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Cardano.CLI.html#parseArgWith"><span class="hs-identifier hs-var">parseArgWith</span></a><span> </span><a href="#local-6989586621679159567"><span class="hs-identifier hs-var">cliDefinition</span></a><span> </span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">arguments</span></a><span> </span><a href="#local-6989586621679160104"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-346"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-347"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- | Interprets the given environment and executes a CLI command.</span><span>
</span><a name="line-350"></a><span class="hs-identifier">runCliCommand</span><span>
</span><a name="line-351"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679157233"><a href="#local-6989586621679157233"><span class="hs-identifier">t</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-352"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">DecodeAddress</span><span> </span><a href="#local-6989586621679157233"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-353"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">EncodeAddress</span><span> </span><a href="#local-6989586621679157233"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-354"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Cardano.CLI.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span>
</span><a name="line-356"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Manager</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621679157233"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ execServe</span><span>
</span><a name="line-358"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>            </span><span class="hs-comment">-- ^ execLaunch</span><span>
</span><a name="line-359"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-360"></a><a name="runCliCommand"><a href="Cardano.CLI.html#runCliCommand"><span class="hs-identifier">runCliCommand</span></a></a><span> </span><a href="Cardano.CLI.html#Environment"><span class="hs-identifier hs-var">Environment</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679160111"><a href="#local-6989586621679160111"><span class="hs-identifier">manager</span></a></a><span> </span><a name="local-6989586621679160112"><a href="#local-6989586621679160112"><span class="hs-identifier">execServe</span></a></a><span> </span><a name="local-6989586621679160113"><a href="#local-6989586621679160113"><span class="hs-identifier">execLaunch</span></a></a><span>
</span><a name="line-361"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;help&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#help"><span class="hs-identifier hs-var">help</span></a><span> </span><a href="#local-6989586621679160106"><span class="hs-identifier hs-var">cli</span></a><span>
</span><a name="line-362"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shortOption</span><span> </span><span class="hs-char">'h'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#help"><span class="hs-identifier hs-var">help</span></a><span> </span><a href="#local-6989586621679160106"><span class="hs-identifier hs-var">cli</span></a><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;serve&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-365"></a><span>        </span><a href="#local-6989586621679160112"><span class="hs-identifier hs-var">execServe</span></a><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;launch&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-368"></a><span>        </span><a href="#local-6989586621679160113"><span class="hs-identifier hs-var">execLaunch</span></a><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;generate&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-371"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;mnemonic&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-372"></a><span>        </span><a name="local-6989586621679160349"><a href="#local-6989586621679160349"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;size&quot;</span><span>
</span><a name="line-373"></a><span>        </span><a href="Cardano.CLI.html#execGenerateMnemonic"><span class="hs-identifier hs-var">execGenerateMnemonic</span></a><span> </span><a href="#local-6989586621679160349"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;wallet&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-376"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;list&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-377"></a><span>        </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span> </span><a href="#local-6989586621679160286"><span class="hs-identifier hs-var">listWallets</span></a><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;wallet&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-380"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;get&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-381"></a><span>        </span><a name="local-6989586621679160350"><a href="#local-6989586621679160350"><span class="hs-identifier">wId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">argument</span><span> </span><span class="hs-string">&quot;wallet-id&quot;</span><span>
</span><a name="line-382"></a><span>        </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679160285"><span class="hs-identifier hs-var">getWallet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160350"><span class="hs-identifier hs-var">wId</span></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;wallet&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-385"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;create&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-386"></a><span>        </span><a name="local-6989586621679160351"><a href="#local-6989586621679160351"><span class="hs-identifier">wName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">argument</span><span> </span><span class="hs-string">&quot;name&quot;</span><span>
</span><a name="line-387"></a><span>        </span><a name="local-6989586621679160352"><a href="#local-6989586621679160352"><span class="hs-identifier">wGap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;address-pool-gap&quot;</span><span>
</span><a name="line-388"></a><span>        </span><a name="local-6989586621679160355"><a href="#local-6989586621679160355"><span class="hs-identifier">wSeed</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-389"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160353"><a href="#local-6989586621679160353"><span class="hs-identifier">prompt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Please enter a 15&#8211;24 word mnemonic sentence: &quot;</span><span>
</span><a name="line-390"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160354"><a href="#local-6989586621679160354"><span class="hs-identifier">parser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMnemonic</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-number">15</span><span class="hs-special">,</span><span class="hs-number">18</span><span class="hs-special">,</span><span class="hs-number">21</span><span class="hs-special">,</span><span class="hs-number">24</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;seed&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">T.words</span><span>
</span><a name="line-391"></a><span>            </span><a href="Cardano.CLI.html#getLine"><span class="hs-identifier hs-var">getLine</span></a><span> </span><a href="#local-6989586621679160353"><span class="hs-identifier hs-var">prompt</span></a><span> </span><a href="#local-6989586621679160354"><span class="hs-identifier hs-var">parser</span></a><span>
</span><a name="line-392"></a><span>        </span><a name="local-6989586621679160360"><a href="#local-6989586621679160360"><span class="hs-identifier">wSndFactor</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-393"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160356"><a href="#local-6989586621679160356"><span class="hs-identifier">prompt</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-394"></a><span>                    </span><span class="hs-string">&quot;(Enter a blank line if you do not wish to use a second \
                    \factor.)\n\
                    \Please enter a 9&#8211;12 word mnemonic second factor: &quot;</span><span>
</span><a name="line-397"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160357"><a href="#local-6989586621679160357"><span class="hs-identifier">parser</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-398"></a><span>                    </span><a href="Cardano.CLI.html#optional"><span class="hs-identifier hs-var">optional</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMnemonic</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-number">9</span><span class="hs-special">,</span><span class="hs-number">12</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;generation&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">T.words</span><span>
</span><a name="line-399"></a><span>            </span><a href="Cardano.CLI.html#getLine"><span class="hs-identifier hs-var">getLine</span></a><span> </span><a href="#local-6989586621679160356"><span class="hs-identifier hs-var">prompt</span></a><span> </span><a href="#local-6989586621679160357"><span class="hs-identifier hs-var">parser</span></a><span> </span><span class="hs-operator hs-var">&lt;&amp;&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-400"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-401"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679160358"><a href="#local-6989586621679160358"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679160359"><a href="#local-6989586621679160359"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160358"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679160359"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>        </span><a name="local-6989586621679160361"><a href="#local-6989586621679160361"><span class="hs-identifier">wPwd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">getPassphraseWithConfirm</span></a><span>
</span><a name="line-403"></a><span>        </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679160287"><span class="hs-identifier hs-var">postWallet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">WalletPostData</span><span>
</span><a name="line-404"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160352"><span class="hs-identifier hs-var">wGap</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiMnemonicT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">T.words</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679160355"><span class="hs-identifier hs-var">wSeed</span></a><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiMnemonicT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">T.words</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679160360"><span class="hs-identifier hs-var">wSndFactor</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160351"><span class="hs-identifier hs-var">wName</span></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160361"><span class="hs-identifier hs-var">wPwd</span></a><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;wallet&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-411"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;update&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-412"></a><span>        </span><a name="local-6989586621679160362"><a href="#local-6989586621679160362"><span class="hs-identifier">wId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">argument</span><span> </span><span class="hs-string">&quot;wallet-id&quot;</span><span>
</span><a name="line-413"></a><span>        </span><a name="local-6989586621679160363"><a href="#local-6989586621679160363"><span class="hs-identifier">wName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;name&quot;</span><span>
</span><a name="line-414"></a><span>        </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679160288"><span class="hs-identifier hs-var">putWallet</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160362"><span class="hs-identifier hs-var">wId</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">WalletPutData</span><span>
</span><a name="line-415"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160363"><span class="hs-identifier hs-var">wName</span></a><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;wallet&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-418"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;delete&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-419"></a><span>        </span><a name="local-6989586621679160364"><a href="#local-6989586621679160364"><span class="hs-identifier">wId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">argument</span><span> </span><span class="hs-string">&quot;wallet-id&quot;</span><span>
</span><a name="line-420"></a><span>        </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160284"><span class="hs-identifier hs-var">deleteWallet</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160364"><span class="hs-identifier hs-var">wId</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;transaction&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-423"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;create&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-424"></a><span>        </span><a name="local-6989586621679160365"><a href="#local-6989586621679160365"><span class="hs-identifier">wId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">argument</span><span> </span><span class="hs-string">&quot;wallet-id&quot;</span><span>
</span><a name="line-425"></a><span>        </span><a name="local-6989586621679160366"><a href="#local-6989586621679160366"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160108"><span class="hs-identifier hs-var">parseAllArgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;payment&quot;</span><span>
</span><a name="line-426"></a><span>        </span><a name="local-6989586621679160367"><a href="#local-6989586621679160367"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160291"><span class="hs-identifier hs-var">sendRequest</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679160285"><span class="hs-identifier hs-var">getWallet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160365"><span class="hs-identifier hs-var">wId</span></a><span>
</span><a name="line-427"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isRight</span><span> </span><a href="#local-6989586621679160367"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-428"></a><span>            </span><a name="local-6989586621679160368"><a href="#local-6989586621679160368"><span class="hs-identifier">wPwd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">getPassphrase</span></a><span>
</span><a name="line-429"></a><span>            </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679160289"><span class="hs-identifier hs-var">createTransaction</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160365"><span class="hs-identifier hs-var">wId</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-430"></a><span>                </span><span class="hs-identifier hs-var">PostTransactionData</span><span>
</span><a name="line-431"></a><span>                    </span><a href="#local-6989586621679160366"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-432"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160368"><span class="hs-identifier hs-var">wPwd</span></a><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>        </span><span class="hs-keyword">else</span><span>
</span><a name="line-434"></a><span>            </span><a href="#local-6989586621679160292"><span class="hs-identifier hs-var">handleResponse</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span> </span><a href="#local-6989586621679160367"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;address&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-437"></a><span>      </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">command</span><span> </span><span class="hs-string">&quot;list&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-438"></a><span>        </span><a name="local-6989586621679160369"><a href="#local-6989586621679160369"><span class="hs-identifier">wId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">argument</span><span> </span><span class="hs-string">&quot;wallet-id&quot;</span><span>
</span><a name="line-439"></a><span>        </span><a name="local-6989586621679160370"><a href="#local-6989586621679160370"><span class="hs-identifier">maybeState</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160110"><span class="hs-identifier hs-var">parseOptionalArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;state&quot;</span><span>
</span><a name="line-440"></a><span>        </span><a href="#local-6989586621679160290"><span class="hs-identifier hs-var">runClient</span></a><span> </span><span class="hs-identifier hs-var">Aeson.encodePretty</span><span>
</span><a name="line-441"></a><span>            </span><span class="hs-special">(</span><a href="#local-6989586621679160283"><span class="hs-identifier hs-var">listAddresses</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><a href="#local-6989586621679160369"><span class="hs-identifier hs-var">wId</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApiT</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679160370"><span class="hs-identifier hs-var">maybeState</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;version&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-444"></a><span>        </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showVersion</span><span> </span><span class="hs-identifier hs-var">version</span><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span>        </span><span class="hs-identifier hs-var">exitSuccess</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-448"></a><span>        </span><span class="hs-identifier hs-var">exitWithUsage</span><span> </span><a href="#local-6989586621679160106"><span class="hs-identifier hs-var">cli</span></a><span>
</span><a name="line-449"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-identifier">getPassphrase</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Passphrase</span><span> </span><span class="hs-string">&quot;encryption&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-451"></a><span>    </span><a name="local-6989586621679160114"><a href="#local-6989586621679160114"><span class="hs-identifier">getPassphrase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-452"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160296"><a href="#local-6989586621679160296"><span class="hs-identifier">prompt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Please enter a passphrase: &quot;</span><span>
</span><a name="line-453"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160297"><a href="#local-6989586621679160297"><span class="hs-identifier">parser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromText</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Passphrase</span><span> </span><span class="hs-string">&quot;encryption&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>        </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Cardano.CLI.html#getSensitiveLine"><span class="hs-identifier hs-var">getSensitiveLine</span></a><span> </span><a href="#local-6989586621679160296"><span class="hs-identifier hs-var">prompt</span></a><span> </span><a href="#local-6989586621679160297"><span class="hs-identifier hs-var">parser</span></a><span>
</span><a name="line-455"></a><span>    </span><span class="hs-identifier">getPassphraseWithConfirm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Passphrase</span><span> </span><span class="hs-string">&quot;encryption&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>    </span><a name="local-6989586621679160115"><a href="#local-6989586621679160115"><span class="hs-identifier">getPassphraseWithConfirm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-457"></a><span>        </span><a name="local-6989586621679160313"><a href="#local-6989586621679160313"><span class="hs-identifier">wPwd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">getPassphrase</span></a><span>
</span><a name="line-458"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679160316"><a href="#local-6989586621679160316"><span class="hs-identifier">wPwd'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-459"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160314"><a href="#local-6989586621679160314"><span class="hs-identifier">prompt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Enter the passphrase a second time: &quot;</span><span>
</span><a name="line-460"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160315"><a href="#local-6989586621679160315"><span class="hs-identifier">parser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromText</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Passphrase</span><span> </span><span class="hs-string">&quot;encryption&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>            </span><a href="Cardano.CLI.html#getSensitiveLine"><span class="hs-identifier hs-var">getSensitiveLine</span></a><span> </span><a href="#local-6989586621679160314"><span class="hs-identifier hs-var">prompt</span></a><span> </span><a href="#local-6989586621679160315"><span class="hs-identifier hs-var">parser</span></a><span>
</span><a name="line-462"></a><span>        </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160313"><span class="hs-identifier hs-var">wPwd</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679160316"><span class="hs-identifier hs-var">wPwd'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-463"></a><span>            </span><a href="Cardano.CLI.html#putErrLn"><span class="hs-identifier hs-var">putErrLn</span></a><span> </span><span class="hs-string">&quot;Passphrases don't match.&quot;</span><span>
</span><a name="line-464"></a><span>            </span><span class="hs-identifier hs-var">exitFailure</span><span>
</span><a name="line-465"></a><span>        </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679160313"><span class="hs-identifier hs-var">wPwd</span></a><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span>    </span><a name="local-6989586621679160283"><a href="#local-6989586621679160283"><span class="hs-identifier">listAddresses</span></a></a><span> </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span>
</span><a name="line-468"></a><span>        </span><span class="hs-special">(</span><span> </span><a name="local-6989586621679160284"><a href="#local-6989586621679160284"><span class="hs-identifier">deleteWallet</span></a></a><span>
</span><a name="line-469"></a><span>        </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a name="local-6989586621679160285"><a href="#local-6989586621679160285"><span class="hs-identifier">getWallet</span></a></a><span>
</span><a name="line-470"></a><span>        </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a name="local-6989586621679160286"><a href="#local-6989586621679160286"><span class="hs-identifier">listWallets</span></a></a><span>
</span><a name="line-471"></a><span>        </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a name="local-6989586621679160287"><a href="#local-6989586621679160287"><span class="hs-identifier">postWallet</span></a></a><span>
</span><a name="line-472"></a><span>        </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a name="local-6989586621679160288"><a href="#local-6989586621679160288"><span class="hs-identifier">putWallet</span></a></a><span>
</span><a name="line-473"></a><span>        </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-comment">-- Put Wallet Passphrase</span><span>
</span><a name="line-474"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>        </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a name="local-6989586621679160289"><a href="#local-6989586621679160289"><span class="hs-identifier">createTransaction</span></a></a><span>
</span><a name="line-476"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">client</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-string">&quot;v2&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Api</span><span> </span><a href="#local-6989586621679157233"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span>    </span><span class="hs-identifier">runClient</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679160293"><a href="#local-6989586621679160293"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160293"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BL.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ClientM</span><span> </span><a href="#local-6989586621679160293"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-482"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>    </span><a name="local-6989586621679160290"><a href="#local-6989586621679160290"><span class="hs-identifier">runClient</span></a></a><span> </span><a name="local-6989586621679160336"><a href="#local-6989586621679160336"><span class="hs-identifier">encode</span></a></a><span> </span><a name="local-6989586621679160337"><a href="#local-6989586621679160337"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-484"></a><span>        </span><a name="local-6989586621679160338"><a href="#local-6989586621679160338"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679160291"><span class="hs-identifier hs-var">sendRequest</span></a><span> </span><a href="#local-6989586621679160337"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-485"></a><span>        </span><a href="#local-6989586621679160292"><span class="hs-identifier hs-var">handleResponse</span></a><span> </span><a href="#local-6989586621679160336"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679160338"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span>    </span><span class="hs-identifier">sendRequest</span><span>
</span><a name="line-488"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679160294"><a href="#local-6989586621679160294"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-489"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ClientM</span><span> </span><a href="#local-6989586621679160294"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-490"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">ServantError</span><span> </span><a href="#local-6989586621679160294"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>    </span><a name="local-6989586621679160291"><a href="#local-6989586621679160291"><span class="hs-identifier">sendRequest</span></a></a><span> </span><a name="local-6989586621679160339"><a href="#local-6989586621679160339"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-492"></a><span>        </span><a name="local-6989586621679160340"><a href="#local-6989586621679160340"><span class="hs-identifier">port</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getPort</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679160109"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;port&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160341"><a href="#local-6989586621679160341"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkClientEnv</span><span> </span><a href="#local-6989586621679160111"><span class="hs-identifier hs-var">manager</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BaseUrl</span><span> </span><span class="hs-identifier hs-var">Http</span><span> </span><span class="hs-string">&quot;localhost&quot;</span><span> </span><a href="#local-6989586621679160340"><span class="hs-identifier hs-var">port</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-494"></a><span>        </span><span class="hs-identifier hs-var">runClientM</span><span> </span><a href="#local-6989586621679160339"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679160341"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span>    </span><span class="hs-identifier">handleResponse</span><span>
</span><a name="line-497"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679160295"><a href="#local-6989586621679160295"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BL.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-499"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">ServantError</span><span> </span><a href="#local-6989586621679160295"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-500"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>    </span><a name="local-6989586621679160292"><a href="#local-6989586621679160292"><span class="hs-identifier">handleResponse</span></a></a><span> </span><a name="local-6989586621679160342"><a href="#local-6989586621679160342"><span class="hs-identifier">encode</span></a></a><span> </span><a name="local-6989586621679160343"><a href="#local-6989586621679160343"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-502"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679160343"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-503"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679160344"><a href="#local-6989586621679160344"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-504"></a><span>                </span><span class="hs-identifier hs-var">TIO.hPutStrLn</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><span class="hs-string">&quot;Ok.&quot;</span><span>
</span><a name="line-505"></a><span>                </span><span class="hs-identifier hs-var">BL8.putStrLn</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679160342"><span class="hs-identifier hs-var">encode</span></a><span> </span><a href="#local-6989586621679160344"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679160345"><a href="#local-6989586621679160345"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-507"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679160346"><a href="#local-6989586621679160346"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679160345"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-508"></a><span>                        </span><span class="hs-identifier hs-var">FailureResponse</span><span> </span><a name="local-6989586621679160347"><a href="#local-6989586621679160347"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span>
</span><a name="line-509"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.decodeUtf8</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BL.toStrict</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">responseBody</span><span> </span><a href="#local-6989586621679160347"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>                            </span><span class="hs-special">(</span><a href="Cardano.CLI.html#decodeError"><span class="hs-identifier hs-var">decodeError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">responseBody</span><span> </span><a href="#local-6989586621679160347"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>                        </span><span class="hs-identifier hs-var">ConnectionError</span><span> </span><a name="local-6989586621679160348"><a href="#local-6989586621679160348"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-512"></a><span>                            </span><a href="#local-6989586621679160348"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-513"></a><span>                        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-514"></a><span>                            </span><span class="hs-identifier hs-var">T.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679160345"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-515"></a><span>                </span><a href="Cardano.CLI.html#putErrLn"><span class="hs-identifier hs-var">putErrLn</span></a><span> </span><a href="#local-6989586621679160346"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-516"></a><span>                </span><span class="hs-identifier hs-var">exitFailure</span><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                            Launch Command Support
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span class="hs-comment">-- | Execute 'launch' commands. This differs from the 'serve' command as it</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- takes care of also starting a node backend in two separate processes and</span><span>
</span><a name="line-524"></a><span class="hs-comment">-- monitors both processes: if one terminates, then the other one is cancelled.</span><span>
</span><a name="line-525"></a><span class="hs-identifier">execLaunchCommands</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Trace</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Command</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><a name="execLaunchCommands"><a href="Cardano.CLI.html#execLaunchCommands"><span class="hs-identifier">execLaunchCommands</span></a></a><span> </span><a name="local-6989586621679160503"><a href="#local-6989586621679160503"><span class="hs-identifier">tracer</span></a></a><span> </span><a name="local-6989586621679160504"><a href="#local-6989586621679160504"><span class="hs-identifier">stateDir</span></a></a><span> </span><a name="local-6989586621679160505"><a href="#local-6989586621679160505"><span class="hs-identifier">commands</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-527"></a><span>    </span><span class="hs-identifier hs-var">installSignalHandlers</span><span>
</span><a name="line-528"></a><span>    </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#setupStateDir"><span class="hs-identifier hs-var">setupStateDir</span></a><span> </span><a href="#local-6989586621679160503"><span class="hs-identifier hs-var">tracer</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679160504"><span class="hs-identifier hs-var">stateDir</span></a><span>
</span><a name="line-529"></a><span>    </span><span class="hs-identifier hs-var">logInfo</span><span> </span><a href="#local-6989586621679160503"><span class="hs-identifier hs-var">tracer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmt</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nameF</span><span> </span><span class="hs-string">&quot;launch&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">blockListF</span><span> </span><a href="#local-6989586621679160505"><span class="hs-identifier hs-var">commands</span></a><span>
</span><a name="line-530"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ProcessHasExited</span><span> </span><a name="local-6989586621679160720"><a href="#local-6989586621679160720"><span class="hs-identifier">pName</span></a></a><span> </span><a name="local-6989586621679160721"><a href="#local-6989586621679160721"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">launch</span><span> </span><a href="#local-6989586621679160505"><span class="hs-identifier hs-var">commands</span></a><span>
</span><a name="line-531"></a><span>    </span><span class="hs-identifier hs-var">logAlert</span><span> </span><a href="#local-6989586621679160503"><span class="hs-identifier hs-var">tracer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><a href="#local-6989586621679160720"><span class="hs-identifier hs-var">pName</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot; exited with code &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679160721"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>    </span><span class="hs-identifier hs-var">exitWith</span><span> </span><a href="#local-6989586621679160721"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span class="hs-comment">-- | Creates a command that can be used to start the wallet API server.</span><span>
</span><a name="line-535"></a><span class="hs-identifier">commandWalletServe</span><span>
</span><a name="line-536"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-537"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Listen</span><span>
</span><a name="line-538"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-type">Port</span></a><span> </span><span class="hs-string">&quot;Node&quot;</span><span>
</span><a name="line-539"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cardano.CLI.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-542"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hash</span><span> </span><span class="hs-string">&quot;Genesis&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-543"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Command</span><span>
</span><a name="line-544"></a><a name="commandWalletServe"><a href="Cardano.CLI.html#commandWalletServe"><span class="hs-identifier">commandWalletServe</span></a></a><span>
</span><a name="line-545"></a><span>        </span><a name="local-6989586621679160722"><a href="#local-6989586621679160722"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679160723"><a href="#local-6989586621679160723"><span class="hs-identifier">listen</span></a></a><span> </span><a name="local-6989586621679160724"><a href="#local-6989586621679160724"><span class="hs-identifier">backendPort</span></a></a><span> </span><a name="local-6989586621679160725"><a href="#local-6989586621679160725"><span class="hs-identifier">stateDir</span></a></a><span> </span><a name="local-6989586621679160726"><a href="#local-6989586621679160726"><span class="hs-identifier">network</span></a></a><span> </span><a name="local-6989586621679160727"><a href="#local-6989586621679160727"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679160728"><a href="#local-6989586621679160728"><span class="hs-identifier">mGenesisHash</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-546"></a><span>    </span><span class="hs-identifier hs-var">Command</span><span> </span><a href="#local-6989586621679160722"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679160730"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">threadDelay</span><span> </span><a href="#local-6989586621679160729"><span class="hs-identifier hs-var">oneSecond</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Inherit</span><span>
</span><a name="line-547"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-548"></a><span>    </span><a name="local-6989586621679160729"><a href="#local-6989586621679160729"><span class="hs-identifier">oneSecond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1000000</span><span>
</span><a name="line-549"></a><span>    </span><a name="local-6989586621679160730"><a href="#local-6989586621679160730"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span>
</span><a name="line-550"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;serve&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-551"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;--network&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679160726"><span class="hs-identifier hs-var">network</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;local&quot;</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;testnet&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679160726"><span class="hs-identifier hs-var">network</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-552"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679160723"><span class="hs-identifier hs-var">listen</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-553"></a><span>            </span><span class="hs-identifier hs-var">ListenOnRandomPort</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--random-port&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-554"></a><span>            </span><span class="hs-identifier hs-var">ListenOnPort</span><span> </span><a name="local-6989586621679160731"><a href="#local-6989586621679160731"><span class="hs-identifier">port</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--port&quot;</span><span class="hs-special">,</span><span> </span><a href="Cardano.CLI.html#showT"><span class="hs-identifier hs-var">showT</span></a><span> </span><a href="#local-6989586621679160731"><span class="hs-identifier hs-var">port</span></a><span class="hs-special">]</span><span>
</span><a name="line-555"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;--backend-port&quot;</span><span class="hs-special">,</span><span> </span><a href="Cardano.CLI.html#showT"><span class="hs-identifier hs-var">showT</span></a><span> </span><a href="#local-6989586621679160724"><span class="hs-identifier hs-var">backendPort</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-556"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679160732"><a href="#local-6989586621679160732"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--database&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679160732"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><span class="hs-string">&quot;wallet.db&quot;</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679160725"><span class="hs-identifier hs-var">stateDir</span></a><span>
</span><a name="line-557"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Cardano.CLI.html#verbosityToArgs"><span class="hs-identifier hs-var">verbosityToArgs</span></a><span> </span><a href="#local-6989586621679160727"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-558"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679160728"><span class="hs-identifier hs-var">mGenesisHash</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-559"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679160860"><a href="#local-6989586621679160860"><span class="hs-identifier">genesisHash</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;--genesis-hash&quot;</span><span class="hs-special">,</span><span> </span><a href="Cardano.CLI.html#showT"><span class="hs-identifier hs-var">showT</span></a><span> </span><a href="#local-6989586621679160860"><span class="hs-identifier hs-var">genesisHash</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-560"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-561"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">-- | Parse and convert the `--port` or `--random-port` option into a 'Listen'</span><span>
</span><a name="line-564"></a><span class="hs-comment">-- data-type.</span><span>
</span><a name="line-565"></a><span class="hs-identifier">parseWalletListen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cardano.CLI.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Listen</span><span>
</span><a name="line-566"></a><a name="parseWalletListen"><a href="Cardano.CLI.html#parseWalletListen"><span class="hs-identifier">parseWalletListen</span></a></a><span> </span><a href="Cardano.CLI.html#Environment"><span class="hs-identifier hs-var">Environment</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-567"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679161221"><a href="#local-6989586621679161221"><span class="hs-identifier">useRandomPort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679161217"><span class="hs-identifier hs-var">argPresent</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;random-port&quot;</span><span>
</span><a name="line-568"></a><span>    </span><a name="local-6989586621679161222"><a href="#local-6989586621679161222"><span class="hs-identifier">walletPort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679161219"><span class="hs-identifier hs-var">parseArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;port&quot;</span><span>
</span><a name="line-569"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679161221"><span class="hs-identifier hs-var">useRandomPort</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679161222"><span class="hs-identifier hs-var">walletPort</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-570"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ListenOnRandomPort</span><span>
</span><a name="line-571"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679161223"><a href="#local-6989586621679161223"><span class="hs-identifier">port</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ListenOnPort</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getPort</span><span> </span><a href="#local-6989586621679161223"><span class="hs-identifier hs-var">port</span></a><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span class="hs-comment">-- | Initialize a state directory to store blockchain data such as blocks or</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- the wallet database.</span><span>
</span><a name="line-575"></a><span class="hs-identifier">setupStateDir</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Trace</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-576"></a><a name="setupStateDir"><a href="Cardano.CLI.html#setupStateDir"><span class="hs-identifier">setupStateDir</span></a></a><span> </span><a name="local-6989586621679161224"><a href="#local-6989586621679161224"><span class="hs-identifier">tracer</span></a></a><span> </span><a name="local-6989586621679161225"><a href="#local-6989586621679161225"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">doesDirectoryExist</span><span> </span><a href="#local-6989586621679161225"><span class="hs-identifier hs-var">dir</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">logInfo</span><span> </span><a href="#local-6989586621679161224"><span class="hs-identifier hs-var">tracer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Using state directory: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><a href="#local-6989586621679161225"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-578"></a><span>    </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-579"></a><span>        </span><span class="hs-identifier hs-var">logInfo</span><span> </span><a href="#local-6989586621679161224"><span class="hs-identifier hs-var">tracer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Creating state directory: &quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><a href="#local-6989586621679161225"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-580"></a><span>        </span><span class="hs-identifier hs-var">createDirectory</span><span> </span><a href="#local-6989586621679161225"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                                Extra Types
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-comment">-- | Port number with a tag for describing what it is used for</span><span>
</span><a name="line-587"></a><span class="hs-keyword">newtype</span><span> </span><a name="Port"><a href="Cardano.CLI.html#Port"><span class="hs-identifier">Port</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679154729"><a href="#local-6989586621679154729"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Symbol</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="Port"><a href="Cardano.CLI.html#Port"><span class="hs-identifier">Port</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getPort"><a href="Cardano.CLI.html#getPort"><span class="hs-identifier">getPort</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-588"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>
</span><a name="line-591"></a><span class="hs-comment">-- NOTE</span><span>
</span><a name="line-592"></a><span class="hs-comment">-- TCP port ranges from [[-1;65535]] \ {0}</span><span>
</span><a name="line-593"></a><span class="hs-comment">-- However, ports in [[-1; 1023]] \ {0} are well-known ports reserved</span><span>
</span><a name="line-594"></a><span class="hs-comment">-- and only &quot;bindable&quot; through root privileges.</span><span>
</span><a name="line-595"></a><span class="hs-comment">--</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- Ports above 49151 are also reserved for ephemeral connections. This</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- leaves us with a valid range of [[1024;49151]] for TCP ports.</span><span>
</span><a name="line-598"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-type">Port</span></a><span> </span><a href="#local-6989586621679155185"><span class="hs-identifier hs-type">tag</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-599"></a><span>    </span><a name="local-8214565720323790309"><span class="hs-identifier">minBound</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-var">Port</span></a><span> </span><span class="hs-number">1024</span><span>
</span><a name="line-600"></a><span>    </span><a name="local-8214565720323790308"><span class="hs-identifier">maxBound</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-var">Port</span></a><span> </span><span class="hs-number">49151</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">FromText</span><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-type">Port</span></a><span> </span><a href="#local-6989586621679155180"><span class="hs-identifier hs-type">tag</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-603"></a><span>    </span><a name="local-8214565720323791495"><span class="hs-identifier">fromText</span></a><span> </span><a name="local-6989586621679155181"><a href="#local-6989586621679155181"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-604"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679155183"><a href="#local-6989586621679155183"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679155184"><a href="#local-6989586621679155184"><span class="hs-identifier">unconsumed</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">bimap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679155182"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-var">Port</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">decimal</span><span> </span><a href="#local-6989586621679155181"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>        </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.null</span><span> </span><a href="#local-6989586621679155184"><span class="hs-identifier hs-var">unconsumed</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679155183"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier hs-var">minBound</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679155183"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679155182"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-606"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679155183"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-607"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-608"></a><span>        </span><a name="local-6989586621679155182"><a href="#local-6989586621679155182"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TextDecodingError</span><span>
</span><a name="line-609"></a><span>            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;expected a TCP port number between &quot;</span><span>
</span><a name="line-610"></a><span>            </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getPort</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>            </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot; and &quot;</span><span>
</span><a name="line-612"></a><span>            </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getPort</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span class="hs-special">)</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToText</span><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-type">Port</span></a><span> </span><a href="#local-6989586621679155178"><span class="hs-identifier hs-type">tag</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-615"></a><span>    </span><a name="local-8214565720323797589"><span class="hs-identifier">toText</span></a><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#Port"><span class="hs-identifier hs-var">Port</span></a><span> </span><a name="local-6989586621679155179"><a href="#local-6989586621679155179"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toText</span><span> </span><a href="#local-6989586621679155179"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">FromText</span><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#OptionValue"><span class="hs-identifier hs-type">OptionValue</span></a><span> </span><span class="hs-identifier hs-type">Severity</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-618"></a><span>    </span><a name="local-8214565720323791495"><span class="hs-identifier">fromText</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Cardano.CLI.html#OptionValue"><span class="hs-identifier hs-var">OptionValue</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromTextToBoundedEnum</span><span> </span><span class="hs-identifier hs-var">KebabLowerCase</span><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToText</span><span> </span><span class="hs-special">(</span><a href="Cardano.CLI.html#OptionValue"><span class="hs-identifier hs-type">OptionValue</span></a><span> </span><span class="hs-identifier hs-type">Severity</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-621"></a><span>    </span><a name="local-8214565720323797589"><span class="hs-identifier">toText</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toTextFromBoundedEnum</span><span> </span><span class="hs-identifier hs-var">KebabLowerCase</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getOptionValue</span><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                             Parsing Arguments
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-626"></a><span>
</span><a name="line-627"></a><span class="hs-comment">-- | A wrapper to avoid orphan instances for types defined externally.</span><span>
</span><a name="line-628"></a><span class="hs-keyword">newtype</span><span> </span><a name="OptionValue"><a href="Cardano.CLI.html#OptionValue"><span class="hs-identifier">OptionValue</span></a></a><span> </span><a name="local-6989586621679153730"><a href="#local-6989586621679153730"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="OptionValue"><a href="Cardano.CLI.html#OptionValue"><span class="hs-identifier">OptionValue</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getOptionValue"><a href="Cardano.CLI.html#getOptionValue"><span class="hs-identifier">getOptionValue</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679153730"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-629"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-comment">-- | Make an existing parser optional. Returns 'Right Nothing' if the input is</span><span>
</span><a name="line-632"></a><span class="hs-comment">-- empty, without running the parser.</span><span>
</span><a name="line-633"></a><span class="hs-identifier">optional</span><span>
</span><a name="line-634"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679157230"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679157230"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-635"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679157230"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679157231"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679157232"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679157230"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679157231"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679157232"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-637"></a><a name="optional"><a href="Cardano.CLI.html#optional"><span class="hs-identifier">optional</span></a></a><span> </span><a name="local-6989586621679161226"><a href="#local-6989586621679161226"><span class="hs-identifier">parse</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-638"></a><span>    </span><a name="local-6989586621679161227"><a href="#local-6989586621679161227"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679161227"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-639"></a><span>    </span><a name="local-6989586621679161228"><a href="#local-6989586621679161228"><span class="hs-identifier">m</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679161226"><span class="hs-identifier hs-var">parse</span></a><span> </span><a href="#local-6989586621679161228"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-640"></a><span>
</span><a name="line-641"></a><span class="hs-identifier">parseArgWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FromText</span><span> </span><a href="#local-6989586621679157229"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Docopt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Option</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679157229"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-642"></a><a name="parseArgWith"><a href="Cardano.CLI.html#parseArgWith"><span class="hs-identifier">parseArgWith</span></a></a><span> </span><a name="local-6989586621679161229"><a href="#local-6989586621679161229"><span class="hs-identifier">docopt</span></a></a><span> </span><a name="local-6989586621679161230"><a href="#local-6989586621679161230"><span class="hs-identifier">arguments</span></a></a><span> </span><a name="local-6989586621679161231"><a href="#local-6989586621679161231"><span class="hs-identifier">option</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-643"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromText</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679161230"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679161232"><span class="hs-identifier hs-var">getArgOrExit</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679161231"><span class="hs-identifier hs-var">option</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-644"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679161233"><a href="#local-6989586621679161233"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679161233"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-645"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679161234"><a href="#local-6989586621679161234"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-646"></a><span>            </span><a href="Cardano.CLI.html#putErrLn"><span class="hs-identifier hs-var">putErrLn</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">getTextDecodingError</span><span> </span><a href="#local-6989586621679161234"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-647"></a><span>            </span><span class="hs-identifier hs-var">exitFailure</span><span>
</span><a name="line-648"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-649"></a><span>    </span><span class="hs-identifier">getArgOrExit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Option</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-650"></a><span>    </span><a name="local-6989586621679161232"><a href="#local-6989586621679161232"><span class="hs-identifier">getArgOrExit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getArgOrExitWith</span><span> </span><a href="#local-6989586621679161229"><span class="hs-identifier hs-var">docopt</span></a><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-identifier">parseAllArgsWith</span><span>
</span><a name="line-653"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FromText</span><span> </span><a href="#local-6989586621679157228"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Docopt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Option</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><a href="#local-6989586621679157228"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><a name="parseAllArgsWith"><a href="Cardano.CLI.html#parseAllArgsWith"><span class="hs-identifier">parseAllArgsWith</span></a></a><span> </span><a name="local-6989586621679161235"><a href="#local-6989586621679161235"><span class="hs-identifier">docopt</span></a></a><span> </span><a name="local-6989586621679161236"><a href="#local-6989586621679161236"><span class="hs-identifier">arguments</span></a></a><span> </span><a name="local-6989586621679161237"><a href="#local-6989586621679161237"><span class="hs-identifier">option</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-655"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromText</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679161236"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679161238"><span class="hs-identifier hs-var">getAllArgsOrExit</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679161237"><span class="hs-identifier hs-var">option</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-656"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679161644"><a href="#local-6989586621679161644"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679161644"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-657"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679161645"><a href="#local-6989586621679161645"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-658"></a><span>            </span><a href="Cardano.CLI.html#putErrLn"><span class="hs-identifier hs-var">putErrLn</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">getTextDecodingError</span><span> </span><a href="#local-6989586621679161645"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-659"></a><span>            </span><span class="hs-identifier hs-var">exitFailure</span><span>
</span><a name="line-660"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-661"></a><span>    </span><span class="hs-identifier">getAllArgsOrExit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Option</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>    </span><a name="local-6989586621679161238"><a href="#local-6989586621679161238"><span class="hs-identifier">getAllArgsOrExit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#getAllArgsOrExitWith"><span class="hs-identifier hs-var">getAllArgsOrExitWith</span></a><span> </span><a href="#local-6989586621679161235"><span class="hs-identifier hs-var">docopt</span></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-comment">-- | Same as 'getAllArgs', but 'exitWithUsage' if empty list.</span><span>
</span><a name="line-665"></a><span class="hs-comment">--</span><span>
</span><a name="line-666"></a><span class="hs-comment">--   As in 'getAllArgs', if your usage pattern required the option,</span><span>
</span><a name="line-667"></a><span class="hs-comment">--   'getAllArgsOrExitWith' will not exit.</span><span>
</span><a name="line-668"></a><span class="hs-identifier">getAllArgsOrExitWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Docopt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Option</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NE.NonEmpty</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-669"></a><a name="getAllArgsOrExitWith"><a href="Cardano.CLI.html#getAllArgsOrExitWith"><span class="hs-identifier">getAllArgsOrExitWith</span></a></a><span> </span><a name="local-6989586621679161646"><a href="#local-6989586621679161646"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621679161647"><a href="#local-6989586621679161647"><span class="hs-identifier">arguments</span></a></a><span> </span><a name="local-6989586621679161648"><a href="#local-6989586621679161648"><span class="hs-identifier">opt</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-670"></a><span>    </span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="#local-6989586621679161649"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">NE.nonEmpty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getAllArgs</span><span> </span><a href="#local-6989586621679161647"><span class="hs-identifier hs-var">arguments</span></a><span> </span><a href="#local-6989586621679161648"><span class="hs-identifier hs-var">opt</span></a><span>
</span><a name="line-671"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-672"></a><span>    </span><a name="local-6989586621679161649"><a href="#local-6989586621679161649"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">exitWithUsageMessage</span><span> </span><a href="#local-6989586621679161646"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;argument expected for: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679161648"><span class="hs-identifier hs-var">opt</span></a><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-comment">-- | Like 'exitWithUsage', but with a success exit code</span><span>
</span><a name="line-675"></a><span class="hs-identifier">help</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Docopt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-676"></a><a name="help"><a href="Cardano.CLI.html#help"><span class="hs-identifier">help</span></a></a><span> </span><a name="local-6989586621679161650"><a href="#local-6989586621679161650"><span class="hs-identifier">docopt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-677"></a><span>    </span><span class="hs-identifier hs-var">TIO.putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">T.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">usage</span><span> </span><a href="#local-6989586621679161650"><span class="hs-identifier hs-var">docopt</span></a><span>
</span><a name="line-678"></a><span>    </span><span class="hs-identifier hs-var">exitSuccess</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                                  Logging
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-comment">-- | Controls how much information to include in log output.</span><span>
</span><a name="line-685"></a><span class="hs-keyword">data</span><span> </span><a name="Verbosity"><a href="Cardano.CLI.html#Verbosity"><span class="hs-identifier">Verbosity</span></a></a><span>
</span><a name="line-686"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Default"><a href="Cardano.CLI.html#Default"><span class="hs-identifier">Default</span></a></a><span>
</span><a name="line-687"></a><span>        </span><span class="hs-comment">-- ^ The default level of verbosity.</span><span>
</span><a name="line-688"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Quiet"><a href="Cardano.CLI.html#Quiet"><span class="hs-identifier">Quiet</span></a></a><span>
</span><a name="line-689"></a><span>        </span><span class="hs-comment">-- ^ Include less information in the log output.</span><span>
</span><a name="line-690"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Verbose"><a href="Cardano.CLI.html#Verbose"><span class="hs-identifier">Verbose</span></a></a><span>
</span><a name="line-691"></a><span>        </span><span class="hs-comment">-- ^ Include more information in the log output.</span><span>
</span><a name="line-692"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">-- | Determine the minimum 'Severity' level from the specified command line</span><span>
</span><a name="line-695"></a><span class="hs-comment">--   arguments.</span><span>
</span><a name="line-696"></a><span class="hs-identifier">minSeverityFromArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Severity</span><span>
</span><a name="line-697"></a><a name="minSeverityFromArgs"><a href="Cardano.CLI.html#minSeverityFromArgs"><span class="hs-identifier">minSeverityFromArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#verbosityToMinSeverity"><span class="hs-identifier hs-var">verbosityToMinSeverity</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Cardano.CLI.html#verbosityFromArgs"><span class="hs-identifier hs-var">verbosityFromArgs</span></a><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span class="hs-comment">-- | Determine the desired 'Verbosity' level from the specified command line</span><span>
</span><a name="line-700"></a><span class="hs-comment">--   arguments.</span><span>
</span><a name="line-701"></a><span class="hs-identifier">verbosityFromArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Arguments</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cardano.CLI.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-702"></a><a name="verbosityFromArgs"><a href="Cardano.CLI.html#verbosityFromArgs"><span class="hs-identifier">verbosityFromArgs</span></a></a><span> </span><a name="local-6989586621679161651"><a href="#local-6989586621679161651"><span class="hs-identifier">arguments</span></a></a><span>
</span><a name="line-703"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679161651"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPresent</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;quiet&quot;</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#Quiet"><span class="hs-identifier hs-var">Quiet</span></a><span>
</span><a name="line-704"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679161651"><span class="hs-identifier hs-var">arguments</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPresent</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">longOption</span><span> </span><span class="hs-string">&quot;verbose&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a><span>
</span><a name="line-705"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#Default"><span class="hs-identifier hs-var">Default</span></a><span>
</span><a name="line-706"></a><span>
</span><a name="line-707"></a><span class="hs-comment">-- | Convert a given 'Verbosity' level into a list of command line arguments</span><span>
</span><a name="line-708"></a><span class="hs-comment">--   that can be passed through to a sub-process.</span><span>
</span><a name="line-709"></a><span class="hs-identifier">verbosityToArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cardano.CLI.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-710"></a><a name="verbosityToArgs"><a href="Cardano.CLI.html#verbosityToArgs"><span class="hs-identifier">verbosityToArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-711"></a><span>    </span><a href="Cardano.CLI.html#Default"><span class="hs-identifier hs-var">Default</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-712"></a><span>    </span><a href="Cardano.CLI.html#Quiet"><span class="hs-identifier hs-var">Quiet</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--quiet&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-713"></a><span>    </span><a href="Cardano.CLI.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;--verbose&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span class="hs-comment">-- | Map a given 'Verbosity' level onto a 'Severity' level.</span><span>
</span><a name="line-716"></a><span class="hs-identifier">verbosityToMinSeverity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Cardano.CLI.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Severity</span><span>
</span><a name="line-717"></a><a name="verbosityToMinSeverity"><a href="Cardano.CLI.html#verbosityToMinSeverity"><span class="hs-identifier">verbosityToMinSeverity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-718"></a><span>    </span><a href="Cardano.CLI.html#Default"><span class="hs-identifier hs-var">Default</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Info</span><span>
</span><a name="line-719"></a><span>    </span><a href="Cardano.CLI.html#Quiet"><span class="hs-identifier hs-var">Quiet</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Error</span><span>
</span><a name="line-720"></a><span>    </span><a href="Cardano.CLI.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Debug</span><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span class="hs-comment">-- | Initialize logging at the specified minimum 'Severity' level.</span><span>
</span><a name="line-723"></a><span class="hs-identifier">initTracer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Severity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CM.Configuration</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Trace</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><a name="initTracer"><a href="Cardano.CLI.html#initTracer"><span class="hs-identifier">initTracer</span></a></a><span> </span><a name="local-6989586621679161652"><a href="#local-6989586621679161652"><span class="hs-identifier">minSeverity</span></a></a><span> </span><a name="local-6989586621679161653"><a href="#local-6989586621679161653"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-725"></a><span>    </span><a name="local-6989586621679161654"><a href="#local-6989586621679161654"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">defaultConfigStdout</span><span>
</span><a name="line-726"></a><span>    </span><span class="hs-identifier hs-var">CM.setMinSeverity</span><span> </span><a href="#local-6989586621679161654"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679161652"><span class="hs-identifier hs-var">minSeverity</span></a><span>
</span><a name="line-727"></a><span>    </span><span class="hs-identifier hs-var">CM.setSetupBackends</span><span> </span><a href="#local-6989586621679161654"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">CM.KatipBK</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">CM.AggregationBK</span><span class="hs-special">]</span><span>
</span><a name="line-728"></a><span>    </span><a name="local-6989586621679161655"><a href="#local-6989586621679161655"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">appendName</span><span> </span><a href="#local-6989586621679161653"><span class="hs-identifier hs-var">cmd</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-identifier hs-var">setupTrace</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679161654"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;cardano-wallet&quot;</span><span>
</span><a name="line-729"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679161654"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679161655"><span class="hs-identifier hs-var">tr</span></a><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                                 Mnemonics
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-734"></a><span>
</span><a name="line-735"></a><span class="hs-comment">-- | Generate a random mnemonic of the given size 'n' (n = number of words),</span><span>
</span><a name="line-736"></a><span class="hs-comment">-- and print it to stdout.</span><span>
</span><a name="line-737"></a><span class="hs-identifier">execGenerateMnemonic</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-738"></a><a name="execGenerateMnemonic"><a href="Cardano.CLI.html#execGenerateMnemonic"><span class="hs-identifier">execGenerateMnemonic</span></a></a><span> </span><a name="local-6989586621679161656"><a href="#local-6989586621679161656"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-739"></a><span>    </span><a name="local-6989586621679161657"><a href="#local-6989586621679161657"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679161656"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-740"></a><span>        </span><span class="hs-string">&quot;9&quot;</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mnemonicToText</span><span> </span><span class="hs-glyph">@</span><span class="hs-number">9</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">entropyToMnemonic</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">genEntropy</span><span>
</span><a name="line-741"></a><span>        </span><span class="hs-string">&quot;12&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mnemonicToText</span><span> </span><span class="hs-glyph">@</span><span class="hs-number">12</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">entropyToMnemonic</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">genEntropy</span><span>
</span><a name="line-742"></a><span>        </span><span class="hs-string">&quot;15&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mnemonicToText</span><span> </span><span class="hs-glyph">@</span><span class="hs-number">15</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">entropyToMnemonic</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">genEntropy</span><span>
</span><a name="line-743"></a><span>        </span><span class="hs-string">&quot;18&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mnemonicToText</span><span> </span><span class="hs-glyph">@</span><span class="hs-number">18</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">entropyToMnemonic</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">genEntropy</span><span>
</span><a name="line-744"></a><span>        </span><span class="hs-string">&quot;21&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mnemonicToText</span><span> </span><span class="hs-glyph">@</span><span class="hs-number">21</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">entropyToMnemonic</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">genEntropy</span><span>
</span><a name="line-745"></a><span>        </span><span class="hs-string">&quot;24&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mnemonicToText</span><span> </span><span class="hs-glyph">@</span><span class="hs-number">24</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">entropyToMnemonic</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">genEntropy</span><span>
</span><a name="line-746"></a><span>        </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-747"></a><span>            </span><a href="Cardano.CLI.html#putErrLn"><span class="hs-identifier hs-var">putErrLn</span></a><span> </span><span class="hs-string">&quot;Invalid mnemonic size. Expected one of: 9,12,15,18,21,24&quot;</span><span>
</span><a name="line-748"></a><span>            </span><span class="hs-identifier hs-var">exitFailure</span><span>
</span><a name="line-749"></a><span>    </span><span class="hs-identifier hs-var">TIO.putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">T.unwords</span><span> </span><a href="#local-6989586621679161657"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                            Unicode Terminal Helpers
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span class="hs-comment">-- | Override the system output encoding setting. This is needed because the CLI</span><span>
</span><a name="line-756"></a><span class="hs-comment">-- prints UTF-8 characters regardless of the @LANG@ environment variable.</span><span>
</span><a name="line-757"></a><span class="hs-identifier">setUtf8Encoding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-758"></a><a name="setUtf8Encoding"><a href="Cardano.CLI.html#setUtf8Encoding"><span class="hs-identifier">setUtf8Encoding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-759"></a><span>    </span><span class="hs-identifier hs-var">hSetEncoding</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-identifier hs-var">utf8</span><span>
</span><a name="line-760"></a><span>    </span><span class="hs-identifier hs-var">hSetEncoding</span><span> </span><span class="hs-identifier hs-var">stderr</span><span> </span><span class="hs-identifier hs-var">utf8</span><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                            ANSI Terminal Helpers
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-comment">-- | Print an error message in red</span><span>
</span><a name="line-767"></a><span class="hs-identifier">hPutErrLn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-768"></a><a name="hPutErrLn"><a href="Cardano.CLI.html#hPutErrLn"><span class="hs-identifier">hPutErrLn</span></a></a><span> </span><a name="local-6989586621679161888"><a href="#local-6989586621679161888"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679161889"><a href="#local-6989586621679161889"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#withSGR"><span class="hs-identifier hs-var">withSGR</span></a><span> </span><a href="#local-6989586621679161888"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SetColor</span><span> </span><span class="hs-identifier hs-var">Foreground</span><span> </span><span class="hs-identifier hs-var">Vivid</span><span> </span><span class="hs-identifier hs-var">Red</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-769"></a><span>    </span><span class="hs-identifier hs-var">TIO.hPutStrLn</span><span> </span><a href="#local-6989586621679161888"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679161889"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-770"></a><span>
</span><a name="line-771"></a><span class="hs-comment">-- | Like 'hPutErrLn' but with provided default 'Handle'</span><span>
</span><a name="line-772"></a><span class="hs-identifier">putErrLn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-773"></a><a name="putErrLn"><a href="Cardano.CLI.html#putErrLn"><span class="hs-identifier">putErrLn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#hPutErrLn"><span class="hs-identifier hs-var">hPutErrLn</span></a><span> </span><span class="hs-identifier hs-var">stderr</span><span>
</span><a name="line-774"></a><span>
</span><a name="line-775"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                         Processing of Sensitive Data
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-778"></a><span>
</span><a name="line-779"></a><span class="hs-comment">-- | Prompt user and parse the input. Re-prompt on invalid inputs.</span><span>
</span><a name="line-780"></a><span class="hs-identifier">hGetLine</span><span>
</span><a name="line-781"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="#local-6989586621679157215"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-782"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-784"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679157215"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679157216"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679157216"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-786"></a><a name="hGetLine"><a href="Cardano.CLI.html#hGetLine"><span class="hs-identifier">hGetLine</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679161890"><a href="#local-6989586621679161890"><span class="hs-identifier">hstdin</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679161891"><a href="#local-6989586621679161891"><span class="hs-identifier">hstderr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679161892"><a href="#local-6989586621679161892"><span class="hs-identifier">prompt</span></a></a><span> </span><a name="local-6989586621679161893"><a href="#local-6989586621679161893"><span class="hs-identifier">fromT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-787"></a><span>    </span><span class="hs-identifier hs-var">TIO.hPutStr</span><span> </span><a href="#local-6989586621679161891"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><a href="#local-6989586621679161892"><span class="hs-identifier hs-var">prompt</span></a><span>
</span><a name="line-788"></a><span>    </span><a name="local-6989586621679161894"><a href="#local-6989586621679161894"><span class="hs-identifier">txt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">TIO.hGetLine</span><span> </span><a href="#local-6989586621679161890"><span class="hs-identifier hs-var">hstdin</span></a><span>
</span><a name="line-789"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679161893"><span class="hs-identifier hs-var">fromT</span></a><span> </span><a href="#local-6989586621679161894"><span class="hs-identifier hs-var">txt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-790"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679161895"><a href="#local-6989586621679161895"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-791"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679161895"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679161894"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679161896"><a href="#local-6989586621679161896"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-793"></a><span>            </span><a href="Cardano.CLI.html#hPutErrLn"><span class="hs-identifier hs-var">hPutErrLn</span></a><span> </span><a href="#local-6989586621679161891"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pretty</span><span> </span><a href="#local-6989586621679161896"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>            </span><a href="Cardano.CLI.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679161890"><span class="hs-identifier hs-var">hstdin</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679161891"><span class="hs-identifier hs-var">hstderr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679161892"><span class="hs-identifier hs-var">prompt</span></a><span> </span><a href="#local-6989586621679161893"><span class="hs-identifier hs-var">fromT</span></a><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span class="hs-comment">-- | Like 'hGetLine' but with default handles</span><span>
</span><a name="line-797"></a><span class="hs-identifier">getLine</span><span>
</span><a name="line-798"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="#local-6989586621679157213"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-799"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-800"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679157213"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679157214"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-801"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679157214"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-802"></a><a name="getLine"><a href="Cardano.CLI.html#getLine"><span class="hs-identifier">getLine</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">stdin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">stderr</span><span class="hs-special">)</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-comment">-- | Gather user inputs until a newline is met, hiding what's typed with a</span><span>
</span><a name="line-805"></a><span class="hs-comment">-- placeholder character.</span><span>
</span><a name="line-806"></a><span class="hs-identifier">hGetSensitiveLine</span><span>
</span><a name="line-807"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="#local-6989586621679157211"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-808"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-810"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679157211"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679157212"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679157212"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-812"></a><a name="hGetSensitiveLine"><a href="Cardano.CLI.html#hGetSensitiveLine"><span class="hs-identifier">hGetSensitiveLine</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679161897"><a href="#local-6989586621679161897"><span class="hs-identifier">hstdin</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679161898"><a href="#local-6989586621679161898"><span class="hs-identifier">hstderr</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679161899"><a href="#local-6989586621679161899"><span class="hs-identifier">prompt</span></a></a><span> </span><a name="local-6989586621679161900"><a href="#local-6989586621679161900"><span class="hs-identifier">fromT</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-813"></a><span>    </span><a href="Cardano.CLI.html#withBuffering"><span class="hs-identifier hs-var">withBuffering</span></a><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><span class="hs-identifier hs-var">NoBuffering</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-814"></a><span>    </span><a href="Cardano.CLI.html#withBuffering"><span class="hs-identifier hs-var">withBuffering</span></a><span> </span><a href="#local-6989586621679161897"><span class="hs-identifier hs-var">hstdin</span></a><span> </span><span class="hs-identifier hs-var">NoBuffering</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-815"></a><span>    </span><a href="Cardano.CLI.html#withEcho"><span class="hs-identifier hs-var">withEcho</span></a><span> </span><a href="#local-6989586621679161897"><span class="hs-identifier hs-var">hstdin</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-816"></a><span>        </span><span class="hs-identifier hs-var">TIO.hPutStr</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><a href="#local-6989586621679161899"><span class="hs-identifier hs-var">prompt</span></a><span>
</span><a name="line-817"></a><span>        </span><a name="local-6989586621679162152"><a href="#local-6989586621679162152"><span class="hs-identifier">txt</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679161901"><span class="hs-identifier hs-var">getLineProtected</span></a><span> </span><span class="hs-char">'*'</span><span>
</span><a name="line-818"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679161900"><span class="hs-identifier hs-var">fromT</span></a><span> </span><a href="#local-6989586621679162152"><span class="hs-identifier hs-var">txt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-819"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679162153"><a href="#local-6989586621679162153"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-820"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679162153"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679162152"><span class="hs-identifier hs-var">txt</span></a><span class="hs-special">)</span><span>
</span><a name="line-821"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679162154"><a href="#local-6989586621679162154"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-822"></a><span>                </span><a href="Cardano.CLI.html#hPutErrLn"><span class="hs-identifier hs-var">hPutErrLn</span></a><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pretty</span><span> </span><a href="#local-6989586621679162154"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>                </span><a href="Cardano.CLI.html#hGetSensitiveLine"><span class="hs-identifier hs-var">hGetSensitiveLine</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679161897"><span class="hs-identifier hs-var">hstdin</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679161899"><span class="hs-identifier hs-var">prompt</span></a><span> </span><a href="#local-6989586621679161900"><span class="hs-identifier hs-var">fromT</span></a><span>
</span><a name="line-824"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-825"></a><span>    </span><span class="hs-identifier">getLineProtected</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-826"></a><span>    </span><a name="local-6989586621679161901"><a href="#local-6989586621679161901"><span class="hs-identifier">getLineProtected</span></a></a><span> </span><a name="local-6989586621679161902"><a href="#local-6989586621679161902"><span class="hs-identifier">placeholder</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-827"></a><span>        </span><a href="#local-6989586621679161904"><span class="hs-identifier hs-var">getLineProtected'</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-828"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-829"></a><span>        </span><a name="local-6989586621679161903"><a href="#local-6989586621679161903"><span class="hs-identifier">backspace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-number">127</span><span>
</span><a name="line-830"></a><span>        </span><a name="local-6989586621679161904"><a href="#local-6989586621679161904"><span class="hs-identifier">getLineProtected'</span></a></a><span> </span><a name="local-6989586621679161905"><a href="#local-6989586621679161905"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-831"></a><span>            </span><span class="hs-identifier hs-var">hGetChar</span><span> </span><a href="#local-6989586621679161897"><span class="hs-identifier hs-var">hstdin</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-832"></a><span>                </span><span class="hs-char">'\n'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-833"></a><span>                    </span><span class="hs-identifier hs-var">hPutChar</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><span class="hs-char">'\n'</span><span>
</span><a name="line-834"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679161905"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-835"></a><span>                </span><a name="local-6989586621679162041"><a href="#local-6989586621679162041"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679162041"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679161903"><span class="hs-identifier hs-var">backspace</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-836"></a><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">T.null</span><span> </span><a href="#local-6989586621679161905"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-837"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679161904"><span class="hs-identifier hs-var">getLineProtected'</span></a><span> </span><a href="#local-6989586621679161905"><span class="hs-identifier hs-var">line</span></a><span>
</span><a name="line-838"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-839"></a><span>                            </span><span class="hs-identifier hs-var">hCursorBackward</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span>  </span><span class="hs-number">1</span><span>
</span><a name="line-840"></a><span>                            </span><span class="hs-identifier hs-var">hPutChar</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><span class="hs-char">' '</span><span>
</span><a name="line-841"></a><span>                            </span><span class="hs-identifier hs-var">hCursorBackward</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-842"></a><span>                            </span><a href="#local-6989586621679161904"><span class="hs-identifier hs-var">getLineProtected'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">T.init</span><span> </span><a href="#local-6989586621679161905"><span class="hs-identifier hs-var">line</span></a><span class="hs-special">)</span><span>
</span><a name="line-843"></a><span>                </span><a name="local-6989586621679162151"><a href="#local-6989586621679162151"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-844"></a><span>                    </span><span class="hs-identifier hs-var">hPutChar</span><span> </span><a href="#local-6989586621679161898"><span class="hs-identifier hs-var">hstderr</span></a><span> </span><a href="#local-6989586621679161902"><span class="hs-identifier hs-var">placeholder</span></a><span>
</span><a name="line-845"></a><span>                    </span><a href="#local-6989586621679161904"><span class="hs-identifier hs-var">getLineProtected'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679161905"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">T.singleton</span><span> </span><a href="#local-6989586621679162151"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-comment">-- | Like 'hGetSensitiveLine' but with default handles</span><span>
</span><a name="line-848"></a><span class="hs-identifier">getSensitiveLine</span><span>
</span><a name="line-849"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Buildable</span><span> </span><a href="#local-6989586621679156975"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-850"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-851"></a><span>    </span><span class="hs-comment">-- ^ A message to prompt the user</span><span>
</span><a name="line-852"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679156975"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679156976"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-853"></a><span>    </span><span class="hs-comment">-- ^ An explicit parser from 'Text'</span><span>
</span><a name="line-854"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679156976"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-855"></a><a name="getSensitiveLine"><a href="Cardano.CLI.html#getSensitiveLine"><span class="hs-identifier">getSensitiveLine</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cardano.CLI.html#hGetSensitiveLine"><span class="hs-identifier hs-var">hGetSensitiveLine</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">stdin</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">stderr</span><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                                Internals
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span class="hs-identifier">withBuffering</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BufferMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679156974"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679156974"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-862"></a><a name="withBuffering"><a href="Cardano.CLI.html#withBuffering"><span class="hs-identifier">withBuffering</span></a></a><span> </span><a name="local-6989586621679162155"><a href="#local-6989586621679162155"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679162156"><a href="#local-6989586621679162156"><span class="hs-identifier">buffering</span></a></a><span> </span><a name="local-6989586621679162157"><a href="#local-6989586621679162157"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bracket</span><span> </span><a href="#local-6989586621679162158"><span class="hs-identifier hs-var">aFirst</span></a><span> </span><a href="#local-6989586621679162159"><span class="hs-identifier hs-var">aLast</span></a><span> </span><a href="#local-6989586621679162160"><span class="hs-identifier hs-var">aBetween</span></a><span>
</span><a name="line-863"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-864"></a><span>    </span><a name="local-6989586621679162158"><a href="#local-6989586621679162158"><span class="hs-identifier">aFirst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hGetBuffering</span><span> </span><a href="#local-6989586621679162155"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><a href="#local-6989586621679162155"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679162156"><span class="hs-identifier hs-var">buffering</span></a><span class="hs-special">)</span><span>
</span><a name="line-865"></a><span>    </span><a name="local-6989586621679162159"><a href="#local-6989586621679162159"><span class="hs-identifier">aLast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><a href="#local-6989586621679162155"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-866"></a><span>    </span><a name="local-6989586621679162160"><a href="#local-6989586621679162160"><span class="hs-identifier">aBetween</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679162157"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-identifier">withEcho</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679156973"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679156973"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-869"></a><a name="withEcho"><a href="Cardano.CLI.html#withEcho"><span class="hs-identifier">withEcho</span></a></a><span> </span><a name="local-6989586621679162474"><a href="#local-6989586621679162474"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679162475"><a href="#local-6989586621679162475"><span class="hs-identifier">echo</span></a></a><span> </span><a name="local-6989586621679162476"><a href="#local-6989586621679162476"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bracket</span><span> </span><a href="#local-6989586621679162477"><span class="hs-identifier hs-var">aFirst</span></a><span> </span><a href="#local-6989586621679162478"><span class="hs-identifier hs-var">aLast</span></a><span> </span><a href="#local-6989586621679162479"><span class="hs-identifier hs-var">aBetween</span></a><span>
</span><a name="line-870"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-871"></a><span>    </span><a name="local-6989586621679162477"><a href="#local-6989586621679162477"><span class="hs-identifier">aFirst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hGetEcho</span><span> </span><a href="#local-6989586621679162474"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><span class="hs-identifier hs-var">hSetEcho</span><span> </span><a href="#local-6989586621679162474"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679162475"><span class="hs-identifier hs-var">echo</span></a><span class="hs-special">)</span><span>
</span><a name="line-872"></a><span>    </span><a name="local-6989586621679162478"><a href="#local-6989586621679162478"><span class="hs-identifier">aLast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hSetEcho</span><span> </span><a href="#local-6989586621679162474"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-873"></a><span>    </span><a name="local-6989586621679162479"><a href="#local-6989586621679162479"><span class="hs-identifier">aBetween</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679162476"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-874"></a><span>
</span><a name="line-875"></a><span class="hs-identifier">withSGR</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SGR</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679155187"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679155187"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-876"></a><a name="withSGR"><a href="Cardano.CLI.html#withSGR"><span class="hs-identifier">withSGR</span></a></a><span> </span><a name="local-6989586621679162480"><a href="#local-6989586621679162480"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679162481"><a href="#local-6989586621679162481"><span class="hs-identifier">sgr</span></a></a><span> </span><a name="local-6989586621679162482"><a href="#local-6989586621679162482"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsTerminalDevice</span><span> </span><a href="#local-6989586621679162480"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-877"></a><span>    </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">bracket</span><span> </span><a href="#local-6989586621679162483"><span class="hs-identifier hs-var">aFirst</span></a><span> </span><a href="#local-6989586621679162484"><span class="hs-identifier hs-var">aLast</span></a><span> </span><a href="#local-6989586621679162485"><span class="hs-identifier hs-var">aBetween</span></a><span>
</span><a name="line-878"></a><span>    </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679162482"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-879"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-880"></a><span>    </span><a name="local-6989586621679162483"><a href="#local-6989586621679162483"><span class="hs-identifier">aFirst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><span class="hs-identifier hs-var">hSetSGR</span><span> </span><a href="#local-6989586621679162480"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679162481"><span class="hs-identifier hs-var">sgr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-881"></a><span>    </span><a name="local-6989586621679162484"><a href="#local-6989586621679162484"><span class="hs-identifier">aLast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hSetSGR</span><span> </span><a href="#local-6989586621679162480"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-882"></a><span>    </span><a name="local-6989586621679162485"><a href="#local-6989586621679162485"><span class="hs-identifier">aBetween</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679162482"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-883"></a><span>
</span><a name="line-884"></a><span class="hs-comment">{-------------------------------------------------------------------------------
                                 Helpers
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-887"></a><span>
</span><a name="line-888"></a><span class="hs-comment">-- | Decode API error messages and extract the corresponding message.</span><span>
</span><a name="line-889"></a><span class="hs-identifier">decodeError</span><span>
</span><a name="line-890"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BL.ByteString</span><span>
</span><a name="line-891"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-892"></a><a name="decodeError"><a href="Cardano.CLI.html#decodeError"><span class="hs-identifier">decodeError</span></a></a><span> </span><a name="local-6989586621679162486"><a href="#local-6989586621679162486"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-893"></a><span>    </span><a name="local-6989586621679162487"><a href="#local-6989586621679162487"><span class="hs-identifier">obj</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Aeson.decode</span><span> </span><a href="#local-6989586621679162486"><span class="hs-identifier hs-var">bytes</span></a><span>
</span><a name="line-894"></a><span>    </span><span class="hs-identifier hs-var">Aeson.parseMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Aeson.withObject</span><span> </span><span class="hs-string">&quot;Error&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.:</span><span> </span><span class="hs-string">&quot;message&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679162487"><span class="hs-identifier hs-var">obj</span></a><span>
</span><a name="line-895"></a><span>
</span><a name="line-896"></a><span class="hs-comment">-- | Show a data-type through its 'ToText' instance</span><span>
</span><a name="line-897"></a><span class="hs-identifier">showT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ToText</span><span> </span><a href="#local-6989586621679155186"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679155186"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-898"></a><a name="showT"><a href="Cardano.CLI.html#showT"><span class="hs-identifier">showT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.unpack</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">toText</span><span>
</span><a name="line-899"></a></pre></body></html>