<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cardano.Pool.Metrics</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Cardano.Pool.Metrics.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-wallet-core-2019.10.16: The Wallet Backend for a Cardano node.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Pool.Metrics</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Helper</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module can fold over a blockchain to collect metrics about
 Stake pools.</p><p>It interacts with:
 - <a href="Cardano-Wallet-Network.html">Cardano.Wallet.Network</a> which provides the chain
 - <a href="Cardano-Pool-DB.html">Cardano.Pool.DB</a> - which can persist the metrics
 - <a href="Cardano-Wallet-Api-Server.html">Cardano.Wallet.Api.Server</a> - which presents the results in an endpoint</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:activityForEpoch">activityForEpoch</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:EpochNo" title="Cardano.Wallet.Primitive.Types">EpochNo</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:combineMetrics">combineMetrics</a> :: <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>) -&gt; <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/GHC-Natural.html#t:Natural" title="GHC.Natural">Natural</a>) -&gt; <a href="../base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> (<a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>, <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/GHC-Natural.html#t:Natural" title="GHC.Natural">Natural</a>))</li><li class="src short"><span class="keyword">data</span> <a href="#t:ErrMetricsInconsistency">ErrMetricsInconsistency</a> = <a href="#v:ErrMetricsInconsistencyBlockProducerNotInStakeDistr">ErrMetricsInconsistencyBlockProducerNotInStakeDistr</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/GHC-Natural.html#t:Natural" title="GHC.Natural">Natural</a>)</li><li class="src short"><a href="#v:withinSameTip">withinSameTip</a> :: <span class="keyword">forall</span> m header a. (<a href="../base-4.12.0.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> header) =&gt; RetryPolicyM m -&gt; (<a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; m a) -&gt; m header -&gt; (header -&gt; m a) -&gt; m a</li><li class="src short"><span class="keyword">data</span> <a href="#t:ErrWithinSameTip">ErrWithinSameTip</a> = <a href="#v:ErrWithinSameTipMaxRetries">ErrWithinSameTipMaxRetries</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:State">State</a> = <a href="#v:State">State</a> {<ul class="subs"><li><a href="#v:tip">tip</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></li><li><a href="#v:activity">activity</a> :: <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> [<a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a>]</li></ul>}</li><li class="src short"><a href="#v:applyBlock">applyBlock</a> :: (<a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>, <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a>) -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:activityForEpoch" class="def">activityForEpoch</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:EpochNo" title="Cardano.Wallet.Primitive.Types">EpochNo</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Cardano.Pool.Metrics.html#activityForEpoch" class="link">Source</a> <a href="#v:activityForEpoch" class="selflink">#</a></p><div class="doc"><p>For a given epoch, and state, this function returns <em>how many</em> blocks
 each pool produced.</p></div></div><div class="top"><p class="src"><a id="v:combineMetrics" class="def">combineMetrics</a> :: <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>) -&gt; <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/GHC-Natural.html#t:Natural" title="GHC.Natural">Natural</a>) -&gt; <a href="../base-4.12.0.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> (<a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace&quot; <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a>, <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/GHC-Natural.html#t:Natural" title="GHC.Natural">Natural</a>)) <a href="src/Cardano.Pool.Metrics.html#combineMetrics" class="link">Source</a> <a href="#v:combineMetrics" class="selflink">#</a></p><div class="doc"><p>Combines two different sources of data into one:</p><ol><li>A stake-distribution map</li><li>A pool-production map</li></ol><p>If a pool has produced a block without existing in the stake-distribution,
 i.e it exists in (2) but not (1), this function will return
 <code>Left ErrMetricsInconsistencyBlockProducerNotInStakeDistr</code>.</p><p>If a pool is in (1) but not (2), it simply means it has produced 0 blocks so
 far.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ErrMetricsInconsistency" class="def">ErrMetricsInconsistency</a> <a href="src/Cardano.Pool.Metrics.html#ErrMetricsInconsistency" class="link">Source</a> <a href="#t:ErrMetricsInconsistency" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ErrMetricsInconsistencyBlockProducerNotInStakeDistr" class="def">ErrMetricsInconsistencyBlockProducerNotInStakeDistr</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;block&quot; <a href="../base-4.12.0.0/GHC-Natural.html#t:Natural" title="GHC.Natural">Natural</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:ErrMetricsInconsistency" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrMetricsInconsistency:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a></span> <a href="src/Cardano.Pool.Metrics.html#line-71" class="link">Source</a> <a href="#t:ErrMetricsInconsistency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrMetricsInconsistency:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrMetricsInconsistency:Show:2"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a></span> <a href="src/Cardano.Pool.Metrics.html#line-71" class="link">Source</a> <a href="#t:ErrMetricsInconsistency" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrMetricsInconsistency:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Pool-Metrics.html#t:ErrMetricsInconsistency" title="Cardano.Pool.Metrics">ErrMetricsInconsistency</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:1" id="g:1"><h1>Helper</h1></a><div class="top"><p class="src"><a id="v:withinSameTip" class="def">withinSameTip</a> <a href="src/Cardano.Pool.Metrics.html#withinSameTip" class="link">Source</a> <a href="#v:withinSameTip" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../base-4.12.0.0/Control-Monad-IO-Class.html#t:MonadIO" title="Control.Monad.IO.Class">MonadIO</a> m, <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> header)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; RetryPolicyM m</td><td class="doc"><p>Retrying policy to command what to do in case the action wasn't
 executed within the same tip.</p></td></tr><tr><td class="src">-&gt; (<a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; m a)</td><td class="doc"><p>On failure</p></td></tr><tr><td class="src">-&gt; m header</td><td class="doc"><p>A getter for that header.</p></td></tr><tr><td class="src">-&gt; (header -&gt; m a)</td><td class="doc"><p>The action to run</p></td></tr><tr><td class="src">-&gt; m a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Runs an action by making sure that the network header hasn't changed before
 and after the action. This is useful in order to combine data from different
 sources and make sure that all data retrieval and computations happens on a
 same version.</p><p>The action <strong>must</strong> be retry-able (i.e. read-only) for it will be retried if
 the tip has changed before and after the call.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ErrWithinSameTip" class="def">ErrWithinSameTip</a> <a href="src/Cardano.Pool.Metrics.html#ErrWithinSameTip" class="link">Source</a> <a href="#t:ErrWithinSameTip" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ErrWithinSameTipMaxRetries" class="def">ErrWithinSameTipMaxRetries</a></td><td class="doc"><p>Retried too many times</p></td></tr></table></div><div class="subs instances"><details id="i:ErrWithinSameTip" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrWithinSameTip:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a></span> <a href="src/Cardano.Pool.Metrics.html#line-162" class="link">Source</a> <a href="#t:ErrWithinSameTip" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrWithinSameTip:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrWithinSameTip:Show:2"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a></span> <a href="src/Cardano.Pool.Metrics.html#line-162" class="link">Source</a> <a href="#t:ErrWithinSameTip" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrWithinSameTip:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrWithinSameTip:Generic:3"></span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a></span> <a href="src/Cardano.Pool.Metrics.html#line-162" class="link">Source</a> <a href="#t:ErrWithinSameTip" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrWithinSameTip:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> -&gt; <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> x -&gt; <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrWithinSameTip:Rep:4"></span> <span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a></span> <a href="src/Cardano.Pool.Metrics.html#line-162" class="link">Source</a> <a href="#t:ErrWithinSameTip" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrWithinSameTip:Rep:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:ErrWithinSameTip" title="Cardano.Pool.Metrics">ErrWithinSameTip</a> = <a href="../base-4.12.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;ErrWithinSameTip&quot; &quot;Cardano.Pool.Metrics&quot; &quot;cardano-wallet-core-2019.10.16-LUHRrJIIdKs74PBAQizTLw&quot; <a href="../base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;ErrWithinSameTipMaxRetries&quot; <a href="../base-4.12.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> <a href="../base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:U1" title="GHC.Generics">U1</a> :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a>))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:State" class="def">State</a> <a href="src/Cardano.Pool.Metrics.html#State" class="link">Source</a> <a href="#t:State" class="selflink">#</a></p><div class="doc"><p>In-memory state keeping track of which pool produced blocks at which slots.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:State" class="def">State</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:tip" class="def">tip</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></dfn><div class="doc"><p>The blockHeader of the most recently applied block. Used to resume
 restoration from <code>NetworkLayer</code>.</p></div></li><li><dfn class="src"><a id="v:activity" class="def">activity</a> :: <a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> [<a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a>]</dfn><div class="doc"><p>Mapping from pools to the slots where pool produced blocks.</p><p>This is needed internally to support rollback, but publicly, only the
 <em>length of</em> the SlotId-list is likely needed.</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:State" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:State:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a></span> <a href="src/Cardano.Pool.Metrics.html#line-178" class="link">Source</a> <a href="#t:State" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:State:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:State:Show:2"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a></span> <a href="src/Cardano.Pool.Metrics.html#line-178" class="link">Source</a> <a href="#t:State" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:State:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:State:Generic:3"></span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a></span> <a href="src/Cardano.Pool.Metrics.html#line-178" class="link">Source</a> <a href="#t:State" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:State:Generic:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> x -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:State:Buildable:4"></span> Buildable <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a></span> <a href="src/Cardano.Pool.Metrics.html#line-180" class="link">Source</a> <a href="#t:State" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:State:Buildable:4"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:build">build</a> :: <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="../text-1.2.3.1/Data-Text-Lazy-Builder.html#t:Builder" title="Data.Text.Lazy.Builder">Builder</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:State:Rep:5"></span> <span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a></span> <a href="src/Cardano.Pool.Metrics.html#line-178" class="link">Source</a> <a href="#t:State" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:State:Rep:5"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Pool-Metrics.html">Cardano.Pool.Metrics</a></p> <div class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> = <a href="../base-4.12.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;State&quot; &quot;Cardano.Pool.Metrics&quot; &quot;cardano-wallet-core-2019.10.16-LUHRrJIIdKs74PBAQizTLw&quot; <a href="../base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;State&quot; <a href="../base-4.12.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> <a href="../base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="../base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;tip&quot;) <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>) <a href="../base-4.12.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="../base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="../base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;activity&quot;) <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> (<a href="../containers-0.6.0.1/Data-Map-Strict.html#t:Map" title="Data.Map.Strict">Map</a> <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a> [<a href="Cardano-Wallet-Primitive-Types.html#t:SlotId" title="Cardano.Wallet.Primitive.Types">SlotId</a>]))))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:applyBlock" class="def">applyBlock</a> :: (<a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a>, <a href="Cardano-Wallet-Primitive-Types.html#t:PoolId" title="Cardano.Wallet.Primitive.Types">PoolId</a>) -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> -&gt; <a href="Cardano-Pool-Metrics.html#t:State" title="Cardano.Pool.Metrics">State</a> <a href="src/Cardano.Pool.Metrics.html#applyBlock" class="link">Source</a> <a href="#v:applyBlock" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>