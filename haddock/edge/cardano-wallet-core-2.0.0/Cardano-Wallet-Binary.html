<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cardano.Wallet.Binary</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Cardano.Wallet.Binary.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-wallet-core-2.0.0: The Wallet Backend for a Cardano node.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>&#169; 2018-2019 IOHK</td></tr><tr><th>License</th><td>MIT</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Wallet.Binary</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Decoding</a></li><li><a href="#g:2">Encoding</a></li><li><a href="#g:3">Helpers</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>These are (partial) CBOR decoders for blocks and block headers. Note that we
 ignore most of the block's and header's content and only retrieve the pieces
 of information relevant to us, wallet (we do assume a trusted node and
 therefore, we needn't to care about verifying signatures and blocks
 themselves).</p><p>The format described in the decoders below are the one used in the Byron era
 of Cardano and will endure in the first stages of Shelley. They are also used
 by components like the Rust <a href="https://github.com/input-output-hk/cardano-http-bridge">cardano-http-bridge</a>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:decodeBlock">decodeBlock</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:Block" title="Cardano.Wallet.Primitive.Types">Block</a></li><li class="src short"><a href="#v:decodeBlockHeader">decodeBlockHeader</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a></li><li class="src short"><a href="#v:decodeTx">decodeTx</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a></li><li class="src short"><a href="#v:decodeTxWitness">decodeTxWitness</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a></li><li class="src short"><a href="#v:decodeSignedTx">decodeSignedTx</a> :: Decoder s (<a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a>, [<a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a>])</li><li class="src short"><a href="#v:encodeTx">encodeTx</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a> -&gt; Encoding</li><li class="src short"><a href="#v:encodeAddress">encodeAddress</a> :: <a href="Cardano-Wallet-Primitive-AddressDerivation.html#t:XPub" title="Cardano.Wallet.Primitive.AddressDerivation">XPub</a> -&gt; Encoding -&gt; Encoding</li><li class="src short"><a href="#v:encodeTxWitness">encodeTxWitness</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a> -&gt; Encoding</li><li class="src short"><a href="#v:encodeSignedTx">encodeSignedTx</a> :: (<a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a>, [<a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a>]) -&gt; Encoding</li><li class="src short"><a href="#v:encodeProtocolMagic">encodeProtocolMagic</a> :: <a href="Cardano-Environment.html#t:ProtocolMagic" title="Cardano.Environment">ProtocolMagic</a> -&gt; Encoding</li><li class="src short"><a href="#v:inspectNextToken">inspectNextToken</a> :: Decoder s ()</li><li class="src short"><a href="#v:decodeList">decodeList</a> :: <span class="keyword">forall</span> s a. Decoder s a -&gt; Decoder s [a]</li><li class="src short"><a href="#v:decodeListIndef">decodeListIndef</a> :: <span class="keyword">forall</span> s a. Decoder s a -&gt; Decoder s [a]</li><li class="src short"><a href="#v:toByteString">toByteString</a> :: Encoding -&gt; <a href="../bytestring-0.10.8.2/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Decoding</h1></a><div class="top"><p class="src"><a id="v:decodeBlock" class="def">decodeBlock</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:Block" title="Cardano.Wallet.Primitive.Types">Block</a> <a href="src/Cardano.Wallet.Binary.html#decodeBlock" class="link">Source</a> <a href="#v:decodeBlock" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:decodeBlockHeader" class="def">decodeBlockHeader</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:BlockHeader" title="Cardano.Wallet.Primitive.Types">BlockHeader</a> <a href="src/Cardano.Wallet.Binary.html#decodeBlockHeader" class="link">Source</a> <a href="#v:decodeBlockHeader" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:decodeTx" class="def">decodeTx</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a> <a href="src/Cardano.Wallet.Binary.html#decodeTx" class="link">Source</a> <a href="#v:decodeTx" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:decodeTxWitness" class="def">decodeTxWitness</a> :: Decoder s <a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a> <a href="src/Cardano.Wallet.Binary.html#decodeTxWitness" class="link">Source</a> <a href="#v:decodeTxWitness" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:decodeSignedTx" class="def">decodeSignedTx</a> :: Decoder s (<a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a>, [<a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a>]) <a href="src/Cardano.Wallet.Binary.html#decodeSignedTx" class="link">Source</a> <a href="#v:decodeSignedTx" class="selflink">#</a></p></div><a href="#g:2" id="g:2"><h1>Encoding</h1></a><div class="top"><p class="src"><a id="v:encodeTx" class="def">encodeTx</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a> -&gt; Encoding <a href="src/Cardano.Wallet.Binary.html#encodeTx" class="link">Source</a> <a href="#v:encodeTx" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:encodeAddress" class="def">encodeAddress</a> :: <a href="Cardano-Wallet-Primitive-AddressDerivation.html#t:XPub" title="Cardano.Wallet.Primitive.AddressDerivation">XPub</a> -&gt; Encoding -&gt; Encoding <a href="src/Cardano.Wallet.Binary.html#encodeAddress" class="link">Source</a> <a href="#v:encodeAddress" class="selflink">#</a></p><div class="doc"><p>Encode a public key to a corresponding Cardano Address. The encoding of the
 attributes part of an address is left out to the caller; This allows for
 distinguishing between Sequential and Random addresses (the former doesn't
 have any attributes to encode).</p><pre>-- Old / Random Addresses
let encodeAttributes = mempty
     &lt;&gt; CBOR.encodeMapLen 1
     &lt;&gt; CBOR.encodeWord8 1
     &lt;&gt; encodeDerivationPath (hdPassphrase rootXPub) accIx addrIx
let addr = encodeAddress xpub encodeAttributes

-- New / Sequential Addresses
let encodeAttributes = mempty &lt;&gt; CBOR.encodeMapLen 0
let addr = encodeAddress xpub encodeAttributes
</pre><p>Note that we are passing the behavior to encode attributes as a parameter
 here and do not handle multiple cases in <code><a href="Cardano-Wallet-Binary.html#v:encodeAddress" title="Cardano.Wallet.Binary">encodeAddress</a></code> itself for multiple
 reasons:</p><ul><li>Inversion of control gives us a nicer implementation overall</li><li>Encoding attributes for Random addresses requires more context than just
   the public key (like the wallet root id and some extra logic for encoding
   passphrases). This is just scheme-specific and is better left out of this
   particular function</li></ul></div></div><div class="top"><p class="src"><a id="v:encodeTxWitness" class="def">encodeTxWitness</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a> -&gt; Encoding <a href="src/Cardano.Wallet.Binary.html#encodeTxWitness" class="link">Source</a> <a href="#v:encodeTxWitness" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:encodeSignedTx" class="def">encodeSignedTx</a> :: (<a href="Cardano-Wallet-Primitive-Types.html#t:Tx" title="Cardano.Wallet.Primitive.Types">Tx</a>, [<a href="Cardano-Wallet-Primitive-Types.html#t:TxWitness" title="Cardano.Wallet.Primitive.Types">TxWitness</a>]) -&gt; Encoding <a href="src/Cardano.Wallet.Binary.html#encodeSignedTx" class="link">Source</a> <a href="#v:encodeSignedTx" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:encodeProtocolMagic" class="def">encodeProtocolMagic</a> :: <a href="Cardano-Environment.html#t:ProtocolMagic" title="Cardano.Environment">ProtocolMagic</a> -&gt; Encoding <a href="src/Cardano.Wallet.Binary.html#encodeProtocolMagic" class="link">Source</a> <a href="#v:encodeProtocolMagic" class="selflink">#</a></p></div><a href="#g:3" id="g:3"><h1>Helpers</h1></a><div class="top"><p class="src"><a id="v:inspectNextToken" class="def">inspectNextToken</a> :: Decoder s () <a href="src/Cardano.Wallet.Binary.html#inspectNextToken" class="link">Source</a> <a href="#v:inspectNextToken" class="selflink">#</a></p><div class="doc"><p>Inspect the next token that has to be decoded and print it to the console
 as a trace. Useful for debugging Decoders.
 Example:</p><pre>    myDecoder :: CBOR.Decoder s MyType
    myDecoder = do
        a &lt;- CBOR.decodeWord64
        inspectNextToken
        [...]
</pre></div></div><div class="top"><p class="src"><a id="v:decodeList" class="def">decodeList</a> :: <span class="keyword">forall</span> s a. Decoder s a -&gt; Decoder s [a] <a href="src/Cardano.Wallet.Binary.html#decodeList" class="link">Source</a> <a href="#v:decodeList" class="selflink">#</a></p><div class="doc"><p>Decode an list of known length. Very similar to <code>decodeListIndef</code>.</p><pre>    myDecoder :: CBOR.Decoder s [MyType]
    myDecoder = decodeList decodeOne
      where
        decodeOne :: CBOR.Decoder s MyType
</pre></div></div><div class="top"><p class="src"><a id="v:decodeListIndef" class="def">decodeListIndef</a> :: <span class="keyword">forall</span> s a. Decoder s a -&gt; Decoder s [a] <a href="src/Cardano.Wallet.Binary.html#decodeListIndef" class="link">Source</a> <a href="#v:decodeListIndef" class="selflink">#</a></p><div class="doc"><p>Decode an arbitrary long list. CBOR introduce a &quot;break&quot; character to
 mark the end of the list, so we simply decode each item until we encounter
 a break character.</p><pre>    myDecoder :: CBOR.Decoder s [MyType]
    myDecoder = decodeListIndef decodeOne
      where
        decodeOne :: CBOR.Decoder s MyType
</pre></div></div><div class="top"><p class="src"><a id="v:toByteString" class="def">toByteString</a> :: Encoding -&gt; <a href="../bytestring-0.10.8.2/Data-ByteString.html#t:ByteString" title="Data.ByteString">ByteString</a> <a href="src/Cardano.Wallet.Binary.html#toByteString" class="link">Source</a> <a href="#v:toByteString" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>