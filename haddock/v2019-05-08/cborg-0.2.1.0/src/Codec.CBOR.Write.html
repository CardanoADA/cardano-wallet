<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns        #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveFunctor       #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE MagicHash           #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Module      : Codec.CBOR.Write</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Copyright   : (c) Duncan Coutts 2015-2017</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- License     : BSD3-style (see LICENSE.txt)</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Maintainer  : duncan@community.haskell.org</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Portability : non-portable (GHC extensions)</span><span>
</span><a name="line-16"></a><span class="hs-comment">--</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- Tools for writing out CBOR @'Encoding'@ values in</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- a variety of forms.</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Codec.CBOR.Write</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Codec.CBOR.Write.html#toBuilder"><span class="hs-identifier hs-var">toBuilder</span></a><span>          </span><span class="hs-comment">-- :: Encoding -&gt; B.Builder</span><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Codec.CBOR.Write.html#toLazyByteString"><span class="hs-identifier hs-var">toLazyByteString</span></a><span>   </span><span class="hs-comment">-- :: Encoding -&gt; L.ByteString</span><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Codec.CBOR.Write.html#toStrictByteString"><span class="hs-identifier hs-var">toStrictByteString</span></a><span> </span><span class="hs-comment">-- :: Encoding -&gt; S.ByteString</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-cpp">#include &quot;cbor.h&quot;
</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-cpp">#if ! MIN_VERSION_base(4,11,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Monoid</span><span>
</span><a name="line-33"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Foreign.Ptr</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Builder</span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Builder.Internal</span><span>      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BI</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.ByteString.Builder.Prim</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">condB</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;$&lt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;*&lt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Builder.Prim</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">P</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Builder.Prim.Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PI</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text</span><span>                             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Encoding</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-cpp">#if defined(OPTIMIZE_GMP)
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Exception.Base</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">assert</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Exts</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.Integer.GMP.Internals</span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Gmp</span><span>
</span><a name="line-52"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 710
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Word</span><span>
</span><a name="line-54"></a><span class="hs-cpp">#endif
#endif
</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html"><span class="hs-identifier">Codec.CBOR.ByteArray.Sliced</span></a><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BAS</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><a href="Codec.CBOR.Encoding.html"><span class="hs-identifier">Codec.CBOR.Encoding</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><a href="Codec.CBOR.Magic.html"><span class="hs-identifier">Codec.CBOR.Magic</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- | Turn an @'Encoding'@ into a lazy @'L.ByteString'@ in CBOR binary</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- format.</span><span>
</span><a name="line-65"></a><span class="hs-comment">--</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- @since 0.2.0.0</span><span>
</span><a name="line-67"></a><span class="hs-identifier">toLazyByteString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Codec.CBOR.Encoding.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>     </span><span class="hs-comment">-- ^ The @'Encoding'@ of a CBOR value.</span><span>
</span><a name="line-68"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span> </span><span class="hs-comment">-- ^ The encoded CBOR value.</span><span>
</span><a name="line-69"></a><a name="toLazyByteString"><a href="Codec.CBOR.Write.html#toLazyByteString"><span class="hs-identifier">toLazyByteString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B.toLazyByteString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Codec.CBOR.Write.html#toBuilder"><span class="hs-identifier hs-var">toBuilder</span></a><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- | Turn an @'Encoding'@ into a strict @'S.ByteString'@ in CBOR binary</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- format.</span><span>
</span><a name="line-73"></a><span class="hs-comment">--</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- @since 0.2.0.0</span><span>
</span><a name="line-75"></a><span class="hs-identifier">toStrictByteString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Codec.CBOR.Encoding.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>     </span><span class="hs-comment">-- ^ The @'Encoding'@ of a CBOR value.</span><span>
</span><a name="line-76"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">S.ByteString</span><span> </span><span class="hs-comment">-- ^ The encoded value.</span><span>
</span><a name="line-77"></a><a name="toStrictByteString"><a href="Codec.CBOR.Write.html#toStrictByteString"><span class="hs-identifier">toStrictByteString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L.toStrict</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">B.toLazyByteString</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Codec.CBOR.Write.html#toBuilder"><span class="hs-identifier hs-var">toBuilder</span></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | Turn an @'Encoding'@ into a @'L.ByteString'@ @'B.Builder'@ in CBOR</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- binary format.</span><span>
</span><a name="line-81"></a><span class="hs-comment">--</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- @since 0.2.0.0</span><span>
</span><a name="line-83"></a><span class="hs-identifier">toBuilder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Codec.CBOR.Encoding.html#Encoding"><span class="hs-identifier hs-type">Encoding</span></a><span>  </span><span class="hs-comment">-- ^ The @'Encoding'@ of a CBOR value.</span><span>
</span><a name="line-84"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span> </span><span class="hs-comment">-- ^ The encoded value as a @'B.Builder'@.</span><span>
</span><a name="line-85"></a><a name="toBuilder"><a href="Codec.CBOR.Write.html#toBuilder"><span class="hs-identifier">toBuilder</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Codec.CBOR.Encoding.html#Encoding"><span class="hs-identifier hs-var">Encoding</span></a><span> </span><a name="local-6989586621679105387"><a href="#local-6989586621679105387"><span class="hs-identifier">vs0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">BI.builder</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105387"><span class="hs-identifier hs-var">vs0</span></a><span> </span><a href="Codec.CBOR.Encoding.html#TkEnd"><span class="hs-identifier hs-var">TkEnd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-88"></a><span>    </span><a name="local-6989586621679105327"><a href="#local-6989586621679105327"><span class="hs-identifier">step</span></a></a><span> </span><a name="local-6989586621679105329"><a href="#local-6989586621679105329"><span class="hs-identifier">vs1</span></a></a><span> </span><a name="local-6989586621679105330"><a href="#local-6989586621679105330"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a name="local-6989586621679105331"><a href="#local-6989586621679105331"><span class="hs-identifier">op0</span></a></a><span> </span><a name="local-6989586621679105332"><a href="#local-6989586621679105332"><span class="hs-identifier">ope0</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-89"></a><span>        </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105329"><span class="hs-identifier hs-var">vs1</span></a><span> </span><a href="#local-6989586621679105331"><span class="hs-identifier hs-var">op0</span></a><span>
</span><a name="line-90"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>        </span><a name="local-6989586621679105333"><a href="#local-6989586621679105333"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679105334"><a href="#local-6989586621679105334"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679105335"><a href="#local-6989586621679105335"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-92"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679105328"><span class="hs-identifier hs-var">bound</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679105334"><span class="hs-identifier hs-var">vs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-93"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkWord"><span class="hs-identifier hs-var">TkWord</span></a><span>     </span><a name="local-6989586621679105336"><a href="#local-6989586621679105336"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105337"><a href="#local-6989586621679105337"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#wordMP"><span class="hs-identifier hs-var">wordMP</span></a><span>     </span><a href="#local-6989586621679105336"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105337"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-94"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkWord64"><span class="hs-identifier hs-var">TkWord64</span></a><span>   </span><a name="local-6989586621679105338"><a href="#local-6989586621679105338"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105339"><a href="#local-6989586621679105339"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#word64MP"><span class="hs-identifier hs-var">word64MP</span></a><span>   </span><a href="#local-6989586621679105338"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105339"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkInt"><span class="hs-identifier hs-var">TkInt</span></a><span>      </span><a name="local-6989586621679105340"><a href="#local-6989586621679105340"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105341"><a href="#local-6989586621679105341"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#intMP"><span class="hs-identifier hs-var">intMP</span></a><span>      </span><a href="#local-6989586621679105340"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105341"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-97"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkInt64"><span class="hs-identifier hs-var">TkInt64</span></a><span>    </span><a name="local-6989586621679105342"><a href="#local-6989586621679105342"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105343"><a href="#local-6989586621679105343"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#int64MP"><span class="hs-identifier hs-var">int64MP</span></a><span>    </span><a href="#local-6989586621679105342"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105343"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkBytes"><span class="hs-identifier hs-var">TkBytes</span></a><span>    </span><a name="local-6989586621679105344"><a href="#local-6989586621679105344"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105345"><a href="#local-6989586621679105345"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#bytesMP"><span class="hs-identifier hs-var">bytesMP</span></a><span>  </span><a href="#local-6989586621679105344"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105345"><span class="hs-identifier hs-var">vs'</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkBytesBegin"><span class="hs-identifier hs-var">TkBytesBegin</span></a><span> </span><a name="local-6989586621679105346"><a href="#local-6989586621679105346"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#bytesBeginMP"><span class="hs-identifier hs-var">bytesBeginMP</span></a><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105346"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-101"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkByteArray"><span class="hs-identifier hs-var">TkByteArray</span></a><span> </span><a name="local-6989586621679105347"><a href="#local-6989586621679105347"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105348"><a href="#local-6989586621679105348"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#byteArrayMP"><span class="hs-identifier hs-var">byteArrayMP</span></a><span> </span><a href="#local-6989586621679105347"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105348"><span class="hs-identifier hs-var">vs'</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkUtf8ByteArray"><span class="hs-identifier hs-var">TkUtf8ByteArray</span></a><span> </span><a name="local-6989586621679105349"><a href="#local-6989586621679105349"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105350"><a href="#local-6989586621679105350"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#utf8ByteArrayMP"><span class="hs-identifier hs-var">utf8ByteArrayMP</span></a><span> </span><a href="#local-6989586621679105349"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105350"><span class="hs-identifier hs-var">vs'</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkString"><span class="hs-identifier hs-var">TkString</span></a><span>   </span><a name="local-6989586621679105351"><a href="#local-6989586621679105351"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105352"><a href="#local-6989586621679105352"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#stringMP"><span class="hs-identifier hs-var">stringMP</span></a><span> </span><a href="#local-6989586621679105351"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105352"><span class="hs-identifier hs-var">vs'</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkStringBegin"><span class="hs-identifier hs-var">TkStringBegin</span></a><span> </span><a name="local-6989586621679105353"><a href="#local-6989586621679105353"><span class="hs-identifier">vs'</span></a></a><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#stringBeginMP"><span class="hs-identifier hs-var">stringBeginMP</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105353"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkListLen"><span class="hs-identifier hs-var">TkListLen</span></a><span>  </span><a name="local-6989586621679105354"><a href="#local-6989586621679105354"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105355"><a href="#local-6989586621679105355"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#arrayLenMP"><span class="hs-identifier hs-var">arrayLenMP</span></a><span> </span><a href="#local-6989586621679105354"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105355"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-108"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkListBegin"><span class="hs-identifier hs-var">TkListBegin</span></a><span>  </span><a name="local-6989586621679105356"><a href="#local-6989586621679105356"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#arrayBeginMP"><span class="hs-identifier hs-var">arrayBeginMP</span></a><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105356"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkMapLen"><span class="hs-identifier hs-var">TkMapLen</span></a><span>   </span><a name="local-6989586621679105357"><a href="#local-6989586621679105357"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105358"><a href="#local-6989586621679105358"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#mapLenMP"><span class="hs-identifier hs-var">mapLenMP</span></a><span>   </span><a href="#local-6989586621679105357"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105358"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-111"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkMapBegin"><span class="hs-identifier hs-var">TkMapBegin</span></a><span>   </span><a name="local-6989586621679105359"><a href="#local-6989586621679105359"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#mapBeginMP"><span class="hs-identifier hs-var">mapBeginMP</span></a><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105359"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkTag"><span class="hs-identifier hs-var">TkTag</span></a><span>      </span><a name="local-6989586621679105360"><a href="#local-6989586621679105360"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105361"><a href="#local-6989586621679105361"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#tagMP"><span class="hs-identifier hs-var">tagMP</span></a><span>      </span><a href="#local-6989586621679105360"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105361"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-114"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkTag64"><span class="hs-identifier hs-var">TkTag64</span></a><span>    </span><a name="local-6989586621679105362"><a href="#local-6989586621679105362"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679105363"><a href="#local-6989586621679105363"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#tag64MP"><span class="hs-identifier hs-var">tag64MP</span></a><span>      </span><a href="#local-6989586621679105362"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105363"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-cpp">#if defined(OPTIMIZE_GMP)
</span><span>              </span><span class="hs-comment">-- This code is specialized for GMP implementation of Integer. By</span><span>
</span><a name="line-118"></a><span>              </span><span class="hs-comment">-- looking directly at the constructors we can avoid some checks.</span><span>
</span><a name="line-119"></a><span>              </span><span class="hs-comment">-- S# hold an Int, so we can just use intMP.</span><span>
</span><a name="line-120"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkInteger"><span class="hs-identifier hs-var">TkInteger</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Gmp.S#</span><span> </span><a name="local-6989586621679105364"><a href="#local-6989586621679105364"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679105365"><a href="#local-6989586621679105365"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#intMP"><span class="hs-identifier hs-var">intMP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a href="#local-6989586621679105364"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105365"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-121"></a><span>              </span><span class="hs-comment">-- Jp# is guaranteed to be &gt; 0.</span><span>
</span><a name="line-122"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkInteger"><span class="hs-identifier hs-var">TkInteger</span></a><span> </span><a name="local-6989586621679105366"><a href="#local-6989586621679105366"><span class="hs-identifier">integer</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Gmp.Jp#</span><span> </span><a name="local-6989586621679105367"><a href="#local-6989586621679105367"><span class="hs-identifier">bigNat</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679105368"><a href="#local-6989586621679105368"><span class="hs-identifier">vs'</span></a></a><span>
</span><a name="line-123"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679105366"><span class="hs-identifier hs-var">integer</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-124"></a><span>                    </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#word64MP"><span class="hs-identifier hs-var">word64MP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105366"><span class="hs-identifier hs-var">integer</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105368"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-125"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-126"></a><span>                   </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679105369"><a href="#local-6989586621679105369"><span class="hs-identifier">buffer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span>
</span><a name="line-127"></a><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#bigNatMP"><span class="hs-identifier hs-var">bigNatMP</span></a><span> </span><a href="#local-6989586621679105367"><span class="hs-identifier hs-var">bigNat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105368"><span class="hs-identifier hs-var">vs'</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105369"><span class="hs-identifier hs-var">buffer</span></a><span>
</span><a name="line-128"></a><span>              </span><span class="hs-comment">-- Jn# is guaranteed to be &lt; 0.</span><span>
</span><a name="line-129"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkInteger"><span class="hs-identifier hs-var">TkInteger</span></a><span> </span><a name="local-6989586621679105370"><a href="#local-6989586621679105370"><span class="hs-identifier">integer</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Gmp.Jn#</span><span> </span><a name="local-6989586621679105371"><a href="#local-6989586621679105371"><span class="hs-identifier">bigNat</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679105372"><a href="#local-6989586621679105372"><span class="hs-identifier">vs'</span></a></a><span>
</span><a name="line-130"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679105370"><span class="hs-identifier hs-var">integer</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-131"></a><span>                    </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#negInt64MP"><span class="hs-identifier hs-var">negInt64MP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679105370"><span class="hs-identifier hs-var">integer</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105372"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-132"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-133"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679105373"><a href="#local-6989586621679105373"><span class="hs-identifier">buffer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span>
</span><a name="line-134"></a><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#negBigNatMP"><span class="hs-identifier hs-var">negBigNatMP</span></a><span> </span><a href="#local-6989586621679105371"><span class="hs-identifier hs-var">bigNat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105372"><span class="hs-identifier hs-var">vs'</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105373"><span class="hs-identifier hs-var">buffer</span></a><span>
</span><a name="line-135"></a><span class="hs-cpp">#else
</span><span>              </span><span class="hs-identifier">TkInteger</span><span>  </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">vs'</span><span>
</span><a name="line-137"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-138"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&lt;=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PI.runB</span><span> </span><span class="hs-identifier">word64MP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">op</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">vs'</span><span>
</span><a name="line-140"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&lt;</span><span>  </span><span class="hs-number">0</span><span>
</span><a name="line-141"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PI.runB</span><span> </span><span class="hs-identifier">negInt64MP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">op</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">vs'</span><span>
</span><a name="line-143"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">BI.runBuilderWith</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">integerMP</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">step</span><span> </span><span class="hs-identifier">vs'</span><span> </span><span class="hs-identifier">k</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BI.BufferRange</span><span> </span><span class="hs-identifier">op</span><span> </span><span class="hs-identifier">ope0</span><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-146"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkBool"><span class="hs-identifier hs-var">TkBool</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621679105374"><a href="#local-6989586621679105374"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#falseMP"><span class="hs-identifier hs-var">falseMP</span></a><span>   </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105374"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-147"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkBool"><span class="hs-identifier hs-var">TkBool</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a name="local-6989586621679105375"><a href="#local-6989586621679105375"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#trueMP"><span class="hs-identifier hs-var">trueMP</span></a><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105375"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-148"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkNull"><span class="hs-identifier hs-var">TkNull</span></a><span>       </span><a name="local-6989586621679105376"><a href="#local-6989586621679105376"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#nullMP"><span class="hs-identifier hs-var">nullMP</span></a><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105376"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-149"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkUndef"><span class="hs-identifier hs-var">TkUndef</span></a><span>      </span><a name="local-6989586621679105377"><a href="#local-6989586621679105377"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#undefMP"><span class="hs-identifier hs-var">undefMP</span></a><span>   </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105377"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-150"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkSimple"><span class="hs-identifier hs-var">TkSimple</span></a><span>   </span><a name="local-6989586621679105378"><a href="#local-6989586621679105378"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679105379"><a href="#local-6989586621679105379"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#simpleMP"><span class="hs-identifier hs-var">simpleMP</span></a><span>   </span><a href="#local-6989586621679105378"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105379"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-151"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkFloat16"><span class="hs-identifier hs-var">TkFloat16</span></a><span>  </span><a name="local-6989586621679105380"><a href="#local-6989586621679105380"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679105381"><a href="#local-6989586621679105381"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#halfMP"><span class="hs-identifier hs-var">halfMP</span></a><span>     </span><a href="#local-6989586621679105380"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105381"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-152"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkFloat32"><span class="hs-identifier hs-var">TkFloat32</span></a><span>  </span><a name="local-6989586621679105382"><a href="#local-6989586621679105382"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679105383"><a href="#local-6989586621679105383"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#floatMP"><span class="hs-identifier hs-var">floatMP</span></a><span>    </span><a href="#local-6989586621679105382"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105383"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-153"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkFloat64"><span class="hs-identifier hs-var">TkFloat64</span></a><span>  </span><a name="local-6989586621679105384"><a href="#local-6989586621679105384"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679105385"><a href="#local-6989586621679105385"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#doubleMP"><span class="hs-identifier hs-var">doubleMP</span></a><span>   </span><a href="#local-6989586621679105384"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105385"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-154"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkBreak"><span class="hs-identifier hs-var">TkBreak</span></a><span>      </span><a name="local-6989586621679105386"><a href="#local-6989586621679105386"><span class="hs-identifier">vs'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">PI.runB</span><span> </span><a href="Codec.CBOR.Write.html#breakMP"><span class="hs-identifier hs-var">breakMP</span></a><span>   </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679105333"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679105386"><span class="hs-identifier hs-var">vs'</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span>              </span><a href="Codec.CBOR.Encoding.html#TkEnd"><span class="hs-identifier hs-var">TkEnd</span></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BI.BufferRange</span><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679105332"><span class="hs-identifier hs-var">ope0</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BI.bufferFull</span><span> </span><a href="#local-6989586621679105328"><span class="hs-identifier hs-var">bound</span></a><span> </span><a href="#local-6989586621679105335"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105327"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679105334"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621679105330"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span>    </span><span class="hs-comment">-- The maximum size in bytes of the fixed-size encodings</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-identifier">bound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-162"></a><span>    </span><a name="local-6989586621679105328"><a href="#local-6989586621679105328"><span class="hs-identifier">bound</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">header</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-166"></a><a name="header"><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">P.liftFixedToBounded</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-identifier">constHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><a name="constHeader"><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier">constHeader</span></a></a><span> </span><a name="local-6989586621679105427"><a href="#local-6989586621679105427"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">P.liftFixedToBounded</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679105427"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-identifier">withHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.FixedPrim</span><span> </span><a href="#local-6989586621679105326"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679105326"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><a name="withHeader"><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier">withHeader</span></a></a><span> </span><a name="local-6989586621679105428"><a href="#local-6989586621679105428"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">P.liftFixedToBounded</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">P.word8</span><span> </span><span class="hs-operator hs-var">&gt;*&lt;</span><span> </span><a href="#local-6989586621679105428"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">withConstHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">P.FixedPrim</span><span> </span><a href="#local-6989586621679105325"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><a href="#local-6989586621679105325"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-175"></a><a name="withConstHeader"><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier">withConstHeader</span></a></a><span> </span><a name="local-6989586621679105429"><a href="#local-6989586621679105429"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679105430"><a href="#local-6989586621679105430"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">P.liftFixedToBounded</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679105429"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">P.word8</span><span> </span><span class="hs-operator hs-var">&gt;*&lt;</span><span> </span><a href="#local-6989586621679105430"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">{-
From RFC 7049:

   Major type 0:  an unsigned integer.  The 5-bit additional information
      is either the integer itself (for additional information values 0
      through 23) or the length of additional data.  Additional
      information 24 means the value is represented in an additional
      uint8_t, 25 means a uint16_t, 26 means a uint32_t, and 27 means a
      uint64_t.  For example, the integer 10 is denoted as the one byte
      0b000_01010 (major type 0, additional information 10).  The
      integer 500 would be 0b000_11001 (major type 0, additional
      information 25) followed by the two bytes 0x01f4, which is 500 in
      decimal.

-}</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">wordMP</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-195"></a><span class="hs-identifier">wordMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-196"></a><a name="wordMP"><a href="Codec.CBOR.Write.html#wordMP"><span class="hs-identifier">wordMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">24</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">25</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-200"></a><span class="hs-cpp">#if defined(ARCH_64bit)
</span><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">26</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-202"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">27</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span class="hs-cpp">#else
</span><span>                          </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">&gt;$&lt;</span><span> </span><span class="hs-identifier">withConstHeader</span><span> </span><span class="hs-number">26</span><span> </span><span class="hs-identifier">P.word32BE</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-207"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">word64MP</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-208"></a><span class="hs-identifier">word64MP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-209"></a><a name="word64MP"><a href="Codec.CBOR.Write.html#word64MP"><span class="hs-identifier">word64MP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">24</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">25</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">26</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-214"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">27</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-comment">{-
From RFC 7049:

   Major type 1:  a negative integer.  The encoding follows the rules
      for unsigned integers (major type 0), except that the value is
      then -1 minus the encoded unsigned integer.  For example, the
      integer -500 would be 0b001_11001 (major type 1, additional
      information 25) followed by the two bytes 0x01f3, which is 499 in
      decimal.
-}</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-identifier">negInt64MP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-228"></a><a name="negInt64MP"><a href="Codec.CBOR.Write.html#negInt64MP"><span class="hs-identifier">negInt64MP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0x20</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x38</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x39</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-232"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x3a</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-233"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x3b</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-comment">{-
   Major types 0 and 1 are designed in such a way that they can be
   encoded in C from a signed integer without actually doing an if-then-
   else for positive/negative (Figure 2).  This uses the fact that
   (-1-n), the transformation for major type 1, is the same as ~n
   (bitwise complement) in C unsigned arithmetic; ~n can then be
   expressed as (-1)^n for the negative case, while 0^n leaves n
   unchanged for non-negative.  The sign of a number can be converted to
   -1 for negative and 0 for non-negative (0 or positive) by arithmetic-
   shifting the number by one bit less than the bit length of the number
   (for example, by 63 for 64-bit numbers).

   void encode_sint(int64_t n) {
     uint64t ui = n &gt;&gt; 63;    // extend sign to whole length
     mt = ui &amp; 0x20;          // extract major type
     ui ^= n;                 // complement negatives
     if (ui &lt; 24)
       *p++ = mt + ui;
     else if (ui &lt; 256) {
       *p++ = mt + 24;
       *p++ = ui;
     } else
          ...

            Figure 2: Pseudocode for Encoding a Signed Integer
-}</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">intMP</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-263"></a><span class="hs-identifier">intMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-264"></a><a name="intMP"><a href="Codec.CBOR.Write.html#intMP"><span class="hs-identifier">intMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-265"></a><span>    </span><a href="#local-6989586621679105431"><span class="hs-identifier hs-var">prep</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-266"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105432"><span class="hs-identifier hs-var">encIntSmall</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-267"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105433"><span class="hs-identifier hs-var">encInt8</span></a><span>  </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-268"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105434"><span class="hs-identifier hs-var">encInt16</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-269"></a><span class="hs-cpp">#if defined(ARCH_64bit)
</span><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105435"><span class="hs-identifier hs-var">encInt32</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>                                    </span><span class="hs-special">(</span><a href="#local-6989586621679105436"><span class="hs-identifier hs-var">encInt64</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span class="hs-cpp">#else
</span><span>                                    </span><span class="hs-special">(</span><span class="hs-identifier">encInt32</span><span> </span><span class="hs-operator">&gt;$&lt;</span><span> </span><span class="hs-identifier">withHeader</span><span> </span><span class="hs-identifier">P.word32BE</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span class="hs-cpp">#endif
</span><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-identifier">prep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>    </span><a name="local-6989586621679105431"><a href="#local-6989586621679105431"><span class="hs-identifier">prep</span></a></a><span> </span><a name="local-6989586621679105437"><a href="#local-6989586621679105437"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105440"><span class="hs-identifier hs-var">mt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679105441"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>        </span><span class="hs-identifier">sign</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span>     </span><span class="hs-comment">-- extend sign to whole length</span><span>
</span><a name="line-281"></a><span>        </span><a name="local-6989586621679105438"><a href="#local-6989586621679105438"><span class="hs-identifier">sign</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105437"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeShiftR</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679105439"><span class="hs-identifier hs-var">intBits</span></a><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span class="hs-cpp">#if MIN_VERSION_base(4,7,0)
</span><span>        </span><a name="local-6989586621679105439"><a href="#local-6989586621679105439"><span class="hs-identifier">intBits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">finiteBitSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-284"></a><span class="hs-cpp">#else
</span><span>        </span><span class="hs-identifier">intBits</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bitSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-286"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-288"></a><span>        </span><span class="hs-identifier">mt</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>    </span><span class="hs-comment">-- select major type</span><span>
</span><a name="line-289"></a><span>        </span><a name="local-6989586621679105440"><a href="#local-6989586621679105440"><span class="hs-identifier">mt</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105438"><span class="hs-identifier hs-var">sign</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">0x20</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>        </span><span class="hs-identifier">ui</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span>     </span><span class="hs-comment">-- complement negatives</span><span>
</span><a name="line-292"></a><span>        </span><a name="local-6989586621679105441"><a href="#local-6989586621679105441"><span class="hs-identifier">ui</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105437"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679105438"><span class="hs-identifier hs-var">sign</span></a><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span>    </span><span class="hs-identifier">encIntSmall</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-295"></a><span>    </span><a name="local-6989586621679105432"><a href="#local-6989586621679105432"><span class="hs-identifier">encIntSmall</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679105442"><a href="#local-6989586621679105442"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105443"><a href="#local-6989586621679105443"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621679105442"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105443"><span class="hs-identifier hs-var">ui</span></a><span>
</span><a name="line-296"></a><span>    </span><a name="local-6989586621679105433"><a href="#local-6989586621679105433"><span class="hs-identifier">encInt8</span></a></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621679105444"><a href="#local-6989586621679105444"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105445"><a href="#local-6989586621679105445"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105444"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">24</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105445"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>    </span><a name="local-6989586621679105434"><a href="#local-6989586621679105434"><span class="hs-identifier">encInt16</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679105446"><a href="#local-6989586621679105446"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105447"><a href="#local-6989586621679105447"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105446"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">25</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105447"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>    </span><a name="local-6989586621679105435"><a href="#local-6989586621679105435"><span class="hs-identifier">encInt32</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679105448"><a href="#local-6989586621679105448"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105449"><a href="#local-6989586621679105449"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105448"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">26</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105449"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span class="hs-cpp">#if defined(ARCH_64bit)
</span><span>    </span><a name="local-6989586621679105436"><a href="#local-6989586621679105436"><span class="hs-identifier">encInt64</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679105450"><a href="#local-6989586621679105450"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105451"><a href="#local-6989586621679105451"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105450"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">27</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105451"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">int64MP</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-305"></a><span class="hs-identifier">int64MP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Int64</span><span>
</span><a name="line-306"></a><a name="int64MP"><a href="Codec.CBOR.Write.html#int64MP"><span class="hs-identifier">int64MP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-307"></a><span>    </span><a href="#local-6989586621679105467"><span class="hs-identifier hs-var">prep</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-308"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105468"><span class="hs-identifier hs-var">encIntSmall</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-309"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105469"><span class="hs-identifier hs-var">encInt8</span></a><span>  </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-310"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105470"><span class="hs-identifier hs-var">encInt16</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-311"></a><span>      </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105471"><span class="hs-identifier hs-var">encInt32</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>                                    </span><span class="hs-special">(</span><a href="#local-6989586621679105472"><span class="hs-identifier hs-var">encInt64</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withHeader"><span class="hs-identifier hs-var">withHeader</span></a><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-identifier">prep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>    </span><a name="local-6989586621679105467"><a href="#local-6989586621679105467"><span class="hs-identifier">prep</span></a></a><span> </span><a name="local-6989586621679105473"><a href="#local-6989586621679105473"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105476"><span class="hs-identifier hs-var">mt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679105477"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-318"></a><span>        </span><span class="hs-identifier">sign</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>   </span><span class="hs-comment">-- extend sign to whole length</span><span>
</span><a name="line-319"></a><span>        </span><a name="local-6989586621679105474"><a href="#local-6989586621679105474"><span class="hs-identifier">sign</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105473"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unsafeShiftR</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679105475"><span class="hs-identifier hs-var">intBits</span></a><span class="hs-special">)</span><span>
</span><a name="line-320"></a><span class="hs-cpp">#if MIN_VERSION_base(4,7,0)
</span><span>        </span><a name="local-6989586621679105475"><a href="#local-6989586621679105475"><span class="hs-identifier">intBits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">finiteBitSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-322"></a><span class="hs-cpp">#else
</span><span>        </span><span class="hs-identifier">intBits</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bitSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int64</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-324"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-identifier">mt</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>    </span><span class="hs-comment">-- select major type</span><span>
</span><a name="line-327"></a><span>        </span><a name="local-6989586621679105476"><a href="#local-6989586621679105476"><span class="hs-identifier">mt</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105474"><span class="hs-identifier hs-var">sign</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">0x20</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span>        </span><span class="hs-identifier">ui</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>   </span><span class="hs-comment">-- complement negatives</span><span>
</span><a name="line-330"></a><span>        </span><a name="local-6989586621679105477"><a href="#local-6989586621679105477"><span class="hs-identifier">ui</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105473"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679105474"><span class="hs-identifier hs-var">sign</span></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span>    </span><a name="local-6989586621679105468"><a href="#local-6989586621679105468"><span class="hs-identifier">encIntSmall</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679105478"><a href="#local-6989586621679105478"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105479"><a href="#local-6989586621679105479"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621679105478"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105479"><span class="hs-identifier hs-var">ui</span></a><span>
</span><a name="line-333"></a><span>    </span><a name="local-6989586621679105469"><a href="#local-6989586621679105469"><span class="hs-identifier">encInt8</span></a></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621679105480"><a href="#local-6989586621679105480"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105481"><a href="#local-6989586621679105481"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105480"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">24</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105481"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>    </span><a name="local-6989586621679105470"><a href="#local-6989586621679105470"><span class="hs-identifier">encInt16</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679105482"><a href="#local-6989586621679105482"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105483"><a href="#local-6989586621679105483"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105482"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">25</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105483"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span>    </span><a name="local-6989586621679105471"><a href="#local-6989586621679105471"><span class="hs-identifier">encInt32</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679105484"><a href="#local-6989586621679105484"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105485"><a href="#local-6989586621679105485"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105484"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">26</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105485"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>    </span><a name="local-6989586621679105472"><a href="#local-6989586621679105472"><span class="hs-identifier">encInt64</span></a></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679105486"><a href="#local-6989586621679105486"><span class="hs-identifier">mt</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679105487"><a href="#local-6989586621679105487"><span class="hs-identifier">ui</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105486"><span class="hs-identifier hs-var">mt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">27</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679105487"><span class="hs-identifier hs-var">ui</span></a><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">{-
   Major type 2:  a byte string.  The string's length in bytes is
      represented following the rules for positive integers (major type
      0).  For example, a byte string whose length is 5 would have an
      initial byte of 0b010_00101 (major type 2, additional information
      5 for the length), followed by 5 bytes of binary content.  A byte
      string whose length is 500 would have 3 initial bytes of
      0b010_11001 (major type 2, additional information 25 to indicate a
      two-byte length) followed by the two bytes 0x01f4 for a length of
      500, followed by 500 bytes of binary content.
-}</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-identifier">bytesMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">S.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-351"></a><a name="bytesMP"><a href="Codec.CBOR.Write.html#bytesMP"><span class="hs-identifier">bytesMP</span></a></a><span> </span><a name="local-6989586621679105488"><a href="#local-6989586621679105488"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#bytesLenMP"><span class="hs-identifier hs-var">bytesLenMP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">S.length</span><span> </span><a href="#local-6989586621679105488"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">B.byteString</span><span> </span><a href="#local-6989586621679105488"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-identifier">bytesLenMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-355"></a><a name="bytesLenMP"><a href="Codec.CBOR.Write.html#bytesLenMP"><span class="hs-identifier">bytesLenMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0x40</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x58</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-358"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x59</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-359"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x5a</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-360"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x5b</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span class="hs-identifier">byteArrayMP</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html#SlicedByteArray"><span class="hs-identifier hs-type">BAS.SlicedByteArray</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-362"></a><a name="byteArrayMP"><a href="Codec.CBOR.Write.html#byteArrayMP"><span class="hs-identifier">byteArrayMP</span></a></a><span> </span><a name="local-6989586621679105489"><a href="#local-6989586621679105489"><span class="hs-identifier">ba</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-363"></a><span>    </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#bytesLenMP"><span class="hs-identifier hs-var">bytesLenMP</span></a><span> </span><a href="#local-6989586621679105490"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html#toBuilder"><span class="hs-identifier hs-var">BAS.toBuilder</span></a><span> </span><a href="#local-6989586621679105489"><span class="hs-identifier hs-var">ba</span></a><span>
</span><a name="line-364"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679105490"><a href="#local-6989586621679105490"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html#sizeofSlicedByteArray"><span class="hs-identifier hs-var">BAS.sizeofSlicedByteArray</span></a><span> </span><a href="#local-6989586621679105489"><span class="hs-identifier hs-var">ba</span></a><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-identifier">bytesBeginMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-367"></a><a name="bytesBeginMP"><a href="Codec.CBOR.Write.html#bytesBeginMP"><span class="hs-identifier">bytesBeginMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0x5f</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">{-
   Major type 3:  a text string, specifically a string of Unicode
      characters that is encoded as UTF-8 [RFC3629].  The format of this
      type is identical to that of byte strings (major type 2), that is,
      as with major type 2, the length gives the number of bytes.  This
      type is provided for systems that need to interpret or display
      human-readable text, and allows the differentiation between
      unstructured bytes and text that has a specified repertoire and
      encoding.  In contrast to formats such as JSON, the Unicode
      characters in this type are never escaped.  Thus, a newline
      character (U+000A) is always represented in a string as the byte
      0x0a, and never as the bytes 0x5c6e (the characters &quot;\&quot; and &quot;n&quot;)
      or as 0x5c7530303061 (the characters &quot;\&quot;, &quot;u&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, and
      &quot;a&quot;).
-}</span><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-identifier">stringMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">T.Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-386"></a><a name="stringMP"><a href="Codec.CBOR.Write.html#stringMP"><span class="hs-identifier">stringMP</span></a></a><span> </span><a name="local-6989586621679105491"><a href="#local-6989586621679105491"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-387"></a><span>    </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#stringLenMP"><span class="hs-identifier hs-var">stringLenMP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">S.length</span><span> </span><a href="#local-6989586621679105492"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">B.byteString</span><span> </span><a href="#local-6989586621679105492"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-388"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-389"></a><span>    </span><a name="local-6989586621679105492"><a href="#local-6989586621679105492"><span class="hs-identifier">bs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T.encodeUtf8</span><span> </span><a href="#local-6989586621679105491"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-identifier">stringLenMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-392"></a><a name="stringLenMP"><a href="Codec.CBOR.Write.html#stringLenMP"><span class="hs-identifier">stringLenMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-393"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0x60</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-394"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x78</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-395"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x79</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-396"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x7a</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-397"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x7b</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">stringBeginMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-400"></a><a name="stringBeginMP"><a href="Codec.CBOR.Write.html#stringBeginMP"><span class="hs-identifier">stringBeginMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0x7f</span><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-identifier">utf8ByteArrayMP</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html#SlicedByteArray"><span class="hs-identifier hs-type">BAS.SlicedByteArray</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-403"></a><a name="utf8ByteArrayMP"><a href="Codec.CBOR.Write.html#utf8ByteArrayMP"><span class="hs-identifier">utf8ByteArrayMP</span></a></a><span> </span><a name="local-6989586621679105493"><a href="#local-6989586621679105493"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-404"></a><span>    </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#stringLenMP"><span class="hs-identifier hs-var">stringLenMP</span></a><span> </span><a href="#local-6989586621679105494"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html#toBuilder"><span class="hs-identifier hs-var">BAS.toBuilder</span></a><span> </span><a href="#local-6989586621679105493"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-405"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-406"></a><span>    </span><a name="local-6989586621679105494"><a href="#local-6989586621679105494"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Codec.CBOR.ByteArray.Sliced.html#sizeofSlicedByteArray"><span class="hs-identifier hs-var">BAS.sizeofSlicedByteArray</span></a><span> </span><a href="#local-6989586621679105493"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">{-
   Major type 4:  an array of data items.  Arrays are also called lists,
      sequences, or tuples.  The array's length follows the rules for
      byte strings (major type 2), except that the length denotes the
      number of data items, not the length in bytes that the array takes
      up.  Items in an array do not need to all be of the same type.
      For example, an array that contains 10 items of any type would
      have an initial byte of 0b100_01010 (major type of 4, additional
      information of 10 for the length) followed by the 10 remaining
      items.
-}</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-identifier">arrayLenMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-421"></a><a name="arrayLenMP"><a href="Codec.CBOR.Write.html#arrayLenMP"><span class="hs-identifier">arrayLenMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-422"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0x80</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-423"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x98</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-424"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x99</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-425"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x9a</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-426"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0x9b</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-identifier">arrayBeginMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-429"></a><a name="arrayBeginMP"><a href="Codec.CBOR.Write.html#arrayBeginMP"><span class="hs-identifier">arrayBeginMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0x9f</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-comment">{-
   Major type 5:  a map of pairs of data items.  Maps are also called
      tables, dictionaries, hashes, or objects (in JSON).  A map is
      comprised of pairs of data items, each pair consisting of a key
      that is immediately followed by a value.  The map's length follows
      the rules for byte strings (major type 2), except that the length
      denotes the number of pairs, not the length in bytes that the map
      takes up.  For example, a map that contains 9 pairs would have an
      initial byte of 0b101_01001 (major type of 5, additional
      information of 9 for the number of pairs) followed by the 18
      remaining items.  The first item is the first key, the second item
      is the first value, the third item is the second key, and so on.
      A map that has duplicate keys may be well-formed, but it is not
      valid, and thus it causes indeterminate decoding; see also
      Section 3.7.
-}</span><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span class="hs-identifier">mapLenMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-449"></a><a name="mapLenMP"><a href="Codec.CBOR.Write.html#mapLenMP"><span class="hs-identifier">mapLenMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0xa0</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-451"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xb8</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-452"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xb9</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-453"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xba</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-454"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xbb</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span class="hs-identifier">mapBeginMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><a name="mapBeginMP"><a href="Codec.CBOR.Write.html#mapBeginMP"><span class="hs-identifier">mapBeginMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0xbf</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-comment">{-
   Major type 6:  optional semantic tagging of other major types.

      In CBOR, a data item can optionally be preceded by a tag to give it
      additional semantics while retaining its structure.  The tag is major
      type 6, and represents an integer number as indicated by the tag's
      integer value; the (sole) data item is carried as content data.

      The initial bytes of the tag follow the rules for positive integers
      (major type 0).
-}</span><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-identifier">tagMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-472"></a><a name="tagMP"><a href="Codec.CBOR.Write.html#tagMP"><span class="hs-identifier">tagMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-473"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0xc0</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-474"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xd8</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xd9</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-476"></a><span class="hs-cpp">#if defined(ARCH_64bit)
</span><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xda</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-478"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xdb</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span class="hs-cpp">#else
</span><span>                          </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">&gt;$&lt;</span><span> </span><span class="hs-identifier">withConstHeader</span><span> </span><span class="hs-number">0xda</span><span> </span><span class="hs-identifier">P.word32BE</span><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-483"></a><span class="hs-identifier">tag64MP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-484"></a><a name="tag64MP"><a href="Codec.CBOR.Write.html#tag64MP"><span class="hs-identifier">tag64MP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-485"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-number">0xc0</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-486"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xff</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xd8</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-487"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffff</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xd9</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-488"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0xffffffff</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xda</span><span> </span><span class="hs-identifier hs-var">P.word32BE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-489"></a><span>                          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xdb</span><span> </span><span class="hs-identifier hs-var">P.word64BE</span><span class="hs-special">)</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-comment">{-
   Major type 7:  floating-point numbers and simple data types that need
      no content, as well as the &quot;break&quot; stop code.

      Major type 7 is for two types of data: floating-point numbers and
      &quot;simple values&quot; that do not need any content.  Each value of the
      5-bit additional information in the initial byte has its own separate
      meaning, as defined in Table 1.  Like the major types for integers,
      items of this major type do not carry content data; all the
      information is in the initial bytes.

    +-------------+--------------------------------------------------+
    | 5-Bit Value | Semantics                                        |
    +-------------+--------------------------------------------------+
    | 0..23       | Simple value (value 0..23)                       |
    |             |                                                  |
    | 24          | Simple value (value 32..255 in following byte)   |
    |             |                                                  |
    | 25          | IEEE 754 Half-Precision Float (16 bits follow)   |
    |             |                                                  |
    | 26          | IEEE 754 Single-Precision Float (32 bits follow) |
    |             |                                                  |
    | 27          | IEEE 754 Double-Precision Float (64 bits follow) |
    |             |                                                  |
    | 28-30       | (Unassigned)                                     |
    |             |                                                  |
    | 31          | &quot;break&quot; stop code for indefinite-length items    |
    +-------------+--------------------------------------------------+
-}</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-identifier">simpleMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-522"></a><a name="simpleMP"><a href="Codec.CBOR.Write.html#simpleMP"><span class="hs-identifier">simpleMP</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x17</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">0xe0</span><span> </span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-524"></a><span>                    </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xf8</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span class="hs-identifier">falseMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-527"></a><a name="falseMP"><a href="Codec.CBOR.Write.html#falseMP"><span class="hs-identifier">falseMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0xf4</span><span>
</span><a name="line-528"></a><span>
</span><a name="line-529"></a><span class="hs-identifier">trueMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-530"></a><a name="trueMP"><a href="Codec.CBOR.Write.html#trueMP"><span class="hs-identifier">trueMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0xf5</span><span>
</span><a name="line-531"></a><span>
</span><a name="line-532"></a><span class="hs-identifier">nullMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-533"></a><a name="nullMP"><a href="Codec.CBOR.Write.html#nullMP"><span class="hs-identifier">nullMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0xf6</span><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span class="hs-identifier">undefMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-536"></a><a name="undefMP"><a href="Codec.CBOR.Write.html#undefMP"><span class="hs-identifier">undefMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0xf7</span><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-comment">-- Canonical encoding of a NaN as per RFC 7049, section 3.9.</span><span>
</span><a name="line-539"></a><span class="hs-identifier">canonicalNaN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">PI.BoundedPrim</span><span> </span><a href="#local-6989586621679105324"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-540"></a><a name="canonicalNaN"><a href="Codec.CBOR.Write.html#canonicalNaN"><span class="hs-identifier">canonicalNaN</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">P.liftFixedToBounded</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-number">0xf9</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-number">0x7e</span><span class="hs-special">,</span><span> </span><span class="hs-number">0x00</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>                                   </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span> </span><span class="hs-operator hs-var">&gt;*&lt;</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span> </span><span class="hs-operator hs-var">&gt;*&lt;</span><span> </span><span class="hs-identifier hs-var">P.word8</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-identifier">halfMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Float</span><span>
</span><a name="line-544"></a><a name="halfMP"><a href="Codec.CBOR.Write.html#halfMP"><span class="hs-identifier">halfMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-identifier hs-var">isNaN</span><span> </span><a href="Codec.CBOR.Write.html#canonicalNaN"><span class="hs-identifier hs-var">canonicalNaN</span></a><span>
</span><a name="line-545"></a><span>                     </span><span class="hs-special">(</span><a href="Codec.CBOR.Magic.html#floatToWord16"><span class="hs-identifier hs-var">floatToWord16</span></a><span> </span><span class="hs-operator hs-var">&gt;$&lt;</span><span> </span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xf9</span><span> </span><span class="hs-identifier hs-var">P.word16BE</span><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-identifier">floatMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Float</span><span>
</span><a name="line-548"></a><a name="floatMP"><a href="Codec.CBOR.Write.html#floatMP"><span class="hs-identifier">floatMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-identifier hs-var">isNaN</span><span> </span><a href="Codec.CBOR.Write.html#canonicalNaN"><span class="hs-identifier hs-var">canonicalNaN</span></a><span>
</span><a name="line-549"></a><span>                      </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xfa</span><span> </span><span class="hs-identifier hs-var">P.floatBE</span><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span class="hs-identifier">doubleMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-552"></a><a name="doubleMP"><a href="Codec.CBOR.Write.html#doubleMP"><span class="hs-identifier">doubleMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">condB</span><span> </span><span class="hs-identifier hs-var">isNaN</span><span> </span><a href="Codec.CBOR.Write.html#canonicalNaN"><span class="hs-identifier hs-var">canonicalNaN</span></a><span>
</span><a name="line-553"></a><span>                       </span><span class="hs-special">(</span><a href="Codec.CBOR.Write.html#withConstHeader"><span class="hs-identifier hs-var">withConstHeader</span></a><span> </span><span class="hs-number">0xfb</span><span> </span><span class="hs-identifier hs-var">P.doubleBE</span><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span class="hs-identifier">breakMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.BoundedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-556"></a><a name="breakMP"><a href="Codec.CBOR.Write.html#breakMP"><span class="hs-identifier">breakMP</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Codec.CBOR.Write.html#constHeader"><span class="hs-identifier hs-var">constHeader</span></a><span> </span><span class="hs-number">0xff</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-cpp">#if defined(OPTIMIZE_GMP)
</span><span class="hs-comment">-- ---------------------------------------- --</span><span>
</span><a name="line-560"></a><span class="hs-comment">-- Implementation optimized for integer-gmp --</span><span>
</span><a name="line-561"></a><span class="hs-comment">-- ---------------------------------------- --</span><span>
</span><a name="line-562"></a><span class="hs-identifier">bigNatMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Gmp.BigNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-563"></a><a name="bigNatMP"><a href="Codec.CBOR.Write.html#bigNatMP"><span class="hs-identifier">bigNatMP</span></a></a><span> </span><a name="local-6989586621679105495"><a href="#local-6989586621679105495"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span> </span><span class="hs-number">0xc2</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Codec.CBOR.Write.html#bigNatToBuilder"><span class="hs-identifier hs-var">bigNatToBuilder</span></a><span> </span><a href="#local-6989586621679105495"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span class="hs-identifier">negBigNatMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Gmp.BigNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-566"></a><a name="negBigNatMP"><a href="Codec.CBOR.Write.html#negBigNatMP"><span class="hs-identifier">negBigNatMP</span></a></a><span> </span><a name="local-6989586621679105496"><a href="#local-6989586621679105496"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-567"></a><span>  </span><span class="hs-comment">-- If value `n` is stored in CBOR, it is interpreted as -1 - n. Since BigNat</span><span>
</span><a name="line-568"></a><span>  </span><span class="hs-comment">-- already represents n (note: it's unsigned), we simply decrement it to get</span><span>
</span><a name="line-569"></a><span>  </span><span class="hs-comment">-- the correct encoding.</span><span>
</span><a name="line-570"></a><span>     </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#header"><span class="hs-identifier hs-var">header</span></a><span> </span><span class="hs-number">0xc3</span><span>
</span><a name="line-571"></a><span>  </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Codec.CBOR.Write.html#bigNatToBuilder"><span class="hs-identifier hs-var">bigNatToBuilder</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Gmp.minusBigNatWord</span><span> </span><a href="#local-6989586621679105496"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int2Word#</span><span> </span><span class="hs-number">1#</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span class="hs-identifier">bigNatToBuilder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Gmp.BigNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-574"></a><a name="bigNatToBuilder"><a href="Codec.CBOR.Write.html#bigNatToBuilder"><span class="hs-identifier">bigNatToBuilder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679105497"><span class="hs-identifier hs-var">bigNatBuilder</span></a><span>
</span><a name="line-575"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-576"></a><span>    </span><span class="hs-identifier">bigNatBuilder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Gmp.BigNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">B.Builder</span><span>
</span><a name="line-577"></a><span>    </span><a name="local-6989586621679105497"><a href="#local-6989586621679105497"><span class="hs-identifier">bigNatBuilder</span></a></a><span> </span><a name="local-6989586621679105500"><a href="#local-6989586621679105500"><span class="hs-identifier">bigNat</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-578"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679105501"><a href="#local-6989586621679105501"><span class="hs-identifier">sizeW#</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Gmp.sizeInBaseBigNat</span><span> </span><a href="#local-6989586621679105500"><span class="hs-identifier hs-var">bigNat</span></a><span> </span><span class="hs-number">256#</span><span>
</span><a name="line-579"></a><span>            </span><a name="local-6989586621679105502"><a href="#local-6989586621679105502"><span class="hs-identifier">bounded</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PI.boudedPrim</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">word2Int#</span><span> </span><a href="#local-6989586621679105501"><span class="hs-identifier hs-var">sizeW#</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105498"><span class="hs-identifier hs-var">dumpBigNat</span></a><span> </span><a href="#local-6989586621679105501"><span class="hs-identifier hs-var">sizeW#</span></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="Codec.CBOR.Write.html#bytesLenMP"><span class="hs-identifier hs-var">bytesLenMP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">W#</span><span> </span><a href="#local-6989586621679105501"><span class="hs-identifier hs-var">sizeW#</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">P.primBounded</span><span> </span><a href="#local-6989586621679105502"><span class="hs-identifier hs-var">bounded</span></a><span> </span><a href="#local-6989586621679105500"><span class="hs-identifier hs-var">bigNat</span></a><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span>    </span><span class="hs-identifier">dumpBigNat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Gmp.BigNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="#local-6989586621679105499"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="#local-6989586621679105499"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-583"></a><span>    </span><a name="local-6989586621679105498"><a href="#local-6989586621679105498"><span class="hs-identifier">dumpBigNat</span></a></a><span> </span><a name="local-6989586621679105503"><a href="#local-6989586621679105503"><span class="hs-identifier">sizeW#</span></a></a><span> </span><a name="local-6989586621679105504"><a href="#local-6989586621679105504"><span class="hs-identifier">bigNat</span></a></a><span> </span><a name="local-6989586621679105505"><a href="#local-6989586621679105505"><span class="hs-identifier">ptr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Ptr</span><span> </span><a name="local-6989586621679105506"><a href="#local-6989586621679105506"><span class="hs-identifier">addr#</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-584"></a><span>        </span><span class="hs-comment">-- The last parameter (`1#`) makes the export function use big endian</span><span>
</span><a name="line-585"></a><span>        </span><span class="hs-comment">-- encoding.</span><span>
</span><a name="line-586"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">W#</span><span> </span><a name="local-6989586621679105507"><a href="#local-6989586621679105507"><span class="hs-identifier">written#</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Gmp.exportBigNatToAddr</span><span> </span><a href="#local-6989586621679105504"><span class="hs-identifier hs-var">bigNat</span></a><span> </span><a href="#local-6989586621679105506"><span class="hs-identifier hs-var">addr#</span></a><span> </span><span class="hs-number">1#</span><span>
</span><a name="line-587"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679105508"><a href="#local-6989586621679105508"><span class="hs-identifier">newPtr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679105505"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">word2Int#</span><span> </span><a href="#local-6989586621679105507"><span class="hs-identifier hs-var">written#</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-588"></a><span>            </span><a name="local-6989586621679105509"><a href="#local-6989586621679105509"><span class="hs-identifier">sanity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isTrue#</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679105503"><span class="hs-identifier hs-var">sizeW#</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqWord#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679105507"><span class="hs-identifier hs-var">written#</span></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">assert</span><span> </span><a href="#local-6989586621679105509"><span class="hs-identifier hs-var">sanity</span></a><span> </span><a href="#local-6989586621679105508"><span class="hs-identifier hs-var">newPtr</span></a><span>
</span><a name="line-590"></a><span>
</span><a name="line-591"></a><span class="hs-cpp">#else
</span><span>
</span><a name="line-593"></a><span class="hs-comment">-- ---------------------- --</span><span>
</span><a name="line-594"></a><span class="hs-comment">-- Generic implementation --</span><span>
</span><a name="line-595"></a><span class="hs-comment">-- ---------------------- --</span><span>
</span><a name="line-596"></a><span class="hs-identifier">integerMP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.Builder</span><span>
</span><a name="line-597"></a><span class="hs-identifier">integerMP</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-598"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&gt;=</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">P.primBounded</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-number">0xc2</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">integerToBuilder</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-599"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">P.primBounded</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-number">0xc3</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">integerToBuilder</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-identifier">integerToBuilder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.Builder</span><span>
</span><a name="line-602"></a><span class="hs-identifier">integerToBuilder</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bytesMP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">integerToBytes</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span class="hs-identifier">integerToBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">S.ByteString</span><span>
</span><a name="line-605"></a><span class="hs-identifier">integerToBytes</span><span> </span><span class="hs-identifier">n0</span><span>
</span><a name="line-606"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n0</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">S.pack</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">]</span><span>
</span><a name="line-607"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">S.pack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">reverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">n0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-609"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-610"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">narrow</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span>    </span><span class="hs-identifier">narrow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Word8</span><span>
</span><a name="line-613"></a><span>    </span><span class="hs-identifier">narrow</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span>
</span><a name="line-614"></a><span class="hs-cpp">#endif
</span></pre></body></html>