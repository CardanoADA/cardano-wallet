<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.HTTP2.Encode</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-4"></a><span>    </span><a href="Network.HTTP2.Encode.html#encodeFrame"><span class="hs-identifier hs-var">encodeFrame</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFrameChunks"><span class="hs-identifier hs-var">encodeFrameChunks</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFrameHeader"><span class="hs-identifier hs-var">encodeFrameHeader</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFrameHeaderBuf"><span class="hs-identifier hs-var">encodeFrameHeaderBuf</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFramePayload"><span class="hs-identifier hs-var">encodeFramePayload</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#encodeInfo"><span class="hs-identifier hs-var">encodeInfo</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString.Internal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unsafeCreate</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network.ByteOrder</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">N</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Network.HTTP2.Types.html"><span class="hs-identifier">Network.HTTP2.Types</span></a><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">type</span><span> </span><a name="Builder"><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier">Builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-comment">-- | Auxiliary information for frame encoding.</span><span>
</span><a name="line-26"></a><span class="hs-keyword">data</span><span> </span><a name="EncodeInfo"><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier">EncodeInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EncodeInfo"><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier">EncodeInfo</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- | Flags to be set in a frame header</span><span>
</span><a name="line-28"></a><span>      </span><a name="encodeFlags"><a href="Network.HTTP2.Encode.html#encodeFlags"><span class="hs-identifier">encodeFlags</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Network.HTTP2.Types.html#FrameFlags"><span class="hs-identifier hs-type">FrameFlags</span></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- | Stream id to be set in a frame header</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="encodeStreamId"><a href="Network.HTTP2.Encode.html#encodeStreamId"><span class="hs-identifier">encodeStreamId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Network.HTTP2.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a><span>
</span><a name="line-31"></a><span>    </span><span class="hs-comment">-- | Padding if any. In the case where this value is set but the priority flag is not set, this value gets preference over the priority flag. So, if this value is set, the priority flag is also set.</span><span>
</span><a name="line-32"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="encodePadding"><a href="Network.HTTP2.Encode.html#encodePadding"><span class="hs-identifier">encodePadding</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.HTTP2.Types.html#Padding"><span class="hs-identifier hs-type">Padding</span></a><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Read</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-comment">-- | A smart builder of 'EncodeInfo'.</span><span>
</span><a name="line-38"></a><span class="hs-comment">--</span><span>
</span><a name="line-39"></a><span class="hs-comment">-- &gt;&gt;&gt; encodeInfo setAck 0</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- EncodeInfo {encodeFlags = 1, encodeStreamId = 0, encodePadding = Nothing}</span><span>
</span><a name="line-41"></a><span class="hs-identifier">encodeInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameFlags"><span class="hs-identifier hs-type">FrameFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FrameFlags"><span class="hs-identifier hs-type">FrameFlags</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ stream identifier</span><span>
</span><a name="line-43"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span>
</span><a name="line-44"></a><a name="encodeInfo"><a href="Network.HTTP2.Encode.html#encodeInfo"><span class="hs-identifier">encodeInfo</span></a></a><span> </span><a name="local-6989586621679074526"><a href="#local-6989586621679074526"><span class="hs-identifier">set</span></a></a><span> </span><a name="local-6989586621679074527"><a href="#local-6989586621679074527"><span class="hs-identifier">sid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074526"><span class="hs-identifier hs-var">set</span></a><span> </span><a href="Network.HTTP2.Types.html#defaultFlags"><span class="hs-identifier hs-var">defaultFlags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679074527"><span class="hs-identifier hs-var">sid</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | Encoding an HTTP/2 frame to 'ByteString'.</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- This function is not efficient enough for high performace</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- program because of the concatenation of 'ByteString'.</span><span>
</span><a name="line-51"></a><span class="hs-comment">--</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- &gt;&gt;&gt; encodeFrame (encodeInfo id 1) (DataFrame &quot;body&quot;)</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- &quot;\NUL\NUL\EOT\NUL\NUL\NUL\NUL\NUL\SOHbody&quot;</span><span>
</span><a name="line-54"></a><span class="hs-identifier">encodeFrame</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FramePayload"><span class="hs-identifier hs-type">FramePayload</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-55"></a><a name="encodeFrame"><a href="Network.HTTP2.Encode.html#encodeFrame"><span class="hs-identifier">encodeFrame</span></a></a><span> </span><a name="local-6989586621679074528"><a href="#local-6989586621679074528"><span class="hs-identifier">einfo</span></a></a><span> </span><a name="local-6989586621679074529"><a href="#local-6989586621679074529"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFrameChunks"><span class="hs-identifier hs-var">encodeFrameChunks</span></a><span> </span><a href="#local-6989586621679074528"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074529"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | Encoding an HTTP/2 frame to ['ByteString'].</span><span>
</span><a name="line-58"></a><span class="hs-comment">--   This is suitable for sendMany.</span><span>
</span><a name="line-59"></a><span class="hs-identifier">encodeFrameChunks</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FramePayload"><span class="hs-identifier hs-type">FramePayload</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span>
</span><a name="line-60"></a><a name="encodeFrameChunks"><a href="Network.HTTP2.Encode.html#encodeFrameChunks"><span class="hs-identifier">encodeFrameChunks</span></a></a><span> </span><a name="local-6989586621679074530"><a href="#local-6989586621679074530"><span class="hs-identifier">einfo</span></a></a><span> </span><a name="local-6989586621679074531"><a href="#local-6989586621679074531"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679074533"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679074535"><span class="hs-identifier hs-var">bss</span></a><span>
</span><a name="line-61"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-62"></a><span>    </span><a name="local-6989586621679074532"><a href="#local-6989586621679074532"><span class="hs-identifier">ftid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#framePayloadToFrameTypeId"><span class="hs-identifier hs-var">framePayloadToFrameTypeId</span></a><span> </span><a href="#local-6989586621679074531"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-63"></a><span>    </span><a name="local-6989586621679074533"><a href="#local-6989586621679074533"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFrameHeader"><span class="hs-identifier hs-var">encodeFrameHeader</span></a><span> </span><a href="#local-6989586621679074532"><span class="hs-identifier hs-var">ftid</span></a><span> </span><a href="#local-6989586621679074534"><span class="hs-identifier hs-var">header</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679074534"><a href="#local-6989586621679074534"><span class="hs-identifier">header</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679074535"><a href="#local-6989586621679074535"><span class="hs-identifier">bss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFramePayload"><span class="hs-identifier hs-var">encodeFramePayload</span></a><span> </span><a href="#local-6989586621679074530"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074531"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- | Encoding an HTTP/2 frame header.</span><span>
</span><a name="line-67"></a><span class="hs-comment">--   The frame header must be completed.</span><span>
</span><a name="line-68"></a><span class="hs-identifier">encodeFrameHeader</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Types.html#FrameTypeId"><span class="hs-identifier hs-type">FrameTypeId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-69"></a><a name="encodeFrameHeader"><a href="Network.HTTP2.Encode.html#encodeFrameHeader"><span class="hs-identifier">encodeFrameHeader</span></a></a><span> </span><a name="local-6989586621679074536"><a href="#local-6989586621679074536"><span class="hs-identifier">ftid</span></a></a><span> </span><a name="local-6989586621679074537"><a href="#local-6989586621679074537"><span class="hs-identifier">fhdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCreate</span><span> </span><a href="Network.HTTP2.Types.html#frameHeaderLength"><span class="hs-identifier hs-var">frameHeaderLength</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Network.HTTP2.Encode.html#encodeFrameHeaderBuf"><span class="hs-identifier hs-var">encodeFrameHeaderBuf</span></a><span> </span><a href="#local-6989586621679074536"><span class="hs-identifier hs-var">ftid</span></a><span> </span><a href="#local-6989586621679074537"><span class="hs-identifier hs-var">fhdr</span></a><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- | Writing an encoded HTTP/2 frame header to the buffer.</span><span>
</span><a name="line-72"></a><span class="hs-comment">--   The length of the buffer must be larger than or equal to 9 bytes.</span><span>
</span><a name="line-73"></a><span class="hs-identifier">encodeFrameHeaderBuf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Types.html#FrameTypeId"><span class="hs-identifier hs-type">FrameTypeId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><a name="encodeFrameHeaderBuf"><a href="Network.HTTP2.Encode.html#encodeFrameHeaderBuf"><span class="hs-identifier">encodeFrameHeaderBuf</span></a></a><span> </span><a name="local-6989586621679074538"><a href="#local-6989586621679074538"><span class="hs-identifier">ftid</span></a></a><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074542"><a href="#local-6989586621679074542"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-identifier hs-var">N.poke24</span><span> </span><a href="#local-6989586621679074543"><span class="hs-identifier hs-var">plen</span></a><span>  </span><a href="#local-6989586621679074542"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-identifier hs-var">N.poke8</span><span>  </span><a href="#local-6989586621679074544"><span class="hs-identifier hs-var">typ</span></a><span>   </span><a href="#local-6989586621679074542"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-identifier hs-var">N.poke8</span><span>  </span><a href="#local-6989586621679074540"><span class="hs-identifier hs-var">flags</span></a><span> </span><a href="#local-6989586621679074542"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-identifier hs-var">N.poke32</span><span> </span><a href="#local-6989586621679074545"><span class="hs-identifier hs-var">sid</span></a><span>   </span><a href="#local-6989586621679074542"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">5</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-80"></a><span>    </span><a name="local-6989586621679074543"><a href="#local-6989586621679074543"><span class="hs-identifier">plen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074539"><span class="hs-identifier hs-var">payloadLength</span></a><span>
</span><a name="line-81"></a><span>    </span><a name="local-6989586621679074544"><a href="#local-6989586621679074544"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#fromFrameTypeId"><span class="hs-identifier hs-var">fromFrameTypeId</span></a><span> </span><a href="#local-6989586621679074538"><span class="hs-identifier hs-var">ftid</span></a><span>
</span><a name="line-82"></a><span>    </span><a name="local-6989586621679074545"><a href="#local-6989586621679074545"><span class="hs-identifier">sid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074541"><span class="hs-identifier hs-var">streamId</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- | Encoding an HTTP/2 frame payload.</span><span>
</span><a name="line-85"></a><span class="hs-comment">--   This returns a complete frame header and chunks of payload.</span><span>
</span><a name="line-86"></a><span class="hs-identifier">encodeFramePayload</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FramePayload"><span class="hs-identifier hs-type">FramePayload</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><a name="encodeFramePayload"><a href="Network.HTTP2.Encode.html#encodeFramePayload"><span class="hs-identifier">encodeFramePayload</span></a></a><span> </span><a name="local-6989586621679074546"><a href="#local-6989586621679074546"><span class="hs-identifier">einfo</span></a></a><span> </span><a name="local-6989586621679074547"><a href="#local-6989586621679074547"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074548"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074549"><span class="hs-identifier hs-var">builder</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679074548"><a href="#local-6989586621679074548"><span class="hs-identifier">header</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679074549"><a href="#local-6989586621679074549"><span class="hs-identifier">builder</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#buildFramePayload"><span class="hs-identifier hs-var">buildFramePayload</span></a><span> </span><a href="#local-6989586621679074546"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074547"><span class="hs-identifier hs-var">payload</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-identifier">buildFramePayload</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#FramePayload"><span class="hs-identifier hs-type">FramePayload</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><a name="buildFramePayload"><a href="Network.HTTP2.Encode.html#buildFramePayload"><span class="hs-identifier">buildFramePayload</span></a></a><span> </span><a name="local-6989586621679074550"><a href="#local-6989586621679074550"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#DataFrame"><span class="hs-identifier hs-var">DataFrame</span></a><span> </span><a name="local-6989586621679074551"><a href="#local-6989586621679074551"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-95"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadData"><span class="hs-identifier hs-var">buildFramePayloadData</span></a><span> </span><a href="#local-6989586621679074550"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074551"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-96"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074552"><a href="#local-6989586621679074552"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#HeadersFrame"><span class="hs-identifier hs-var">HeadersFrame</span></a><span> </span><a name="local-6989586621679074553"><a href="#local-6989586621679074553"><span class="hs-identifier">mpri</span></a></a><span> </span><a name="local-6989586621679074554"><a href="#local-6989586621679074554"><span class="hs-identifier">hdr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-97"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadHeaders"><span class="hs-identifier hs-var">buildFramePayloadHeaders</span></a><span> </span><a href="#local-6989586621679074552"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074553"><span class="hs-identifier hs-var">mpri</span></a><span> </span><a href="#local-6989586621679074554"><span class="hs-identifier hs-var">hdr</span></a><span>
</span><a name="line-98"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074555"><a href="#local-6989586621679074555"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#PriorityFrame"><span class="hs-identifier hs-var">PriorityFrame</span></a><span> </span><a name="local-6989586621679074556"><a href="#local-6989586621679074556"><span class="hs-identifier">pri</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-99"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadPriority"><span class="hs-identifier hs-var">buildFramePayloadPriority</span></a><span> </span><a href="#local-6989586621679074555"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074556"><span class="hs-identifier hs-var">pri</span></a><span>
</span><a name="line-100"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074557"><a href="#local-6989586621679074557"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#RSTStreamFrame"><span class="hs-identifier hs-var">RSTStreamFrame</span></a><span> </span><a name="local-6989586621679074558"><a href="#local-6989586621679074558"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-101"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadRSTStream"><span class="hs-identifier hs-var">buildFramePayloadRSTStream</span></a><span> </span><a href="#local-6989586621679074557"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074558"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-102"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074559"><a href="#local-6989586621679074559"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#SettingsFrame"><span class="hs-identifier hs-var">SettingsFrame</span></a><span> </span><a name="local-6989586621679074560"><a href="#local-6989586621679074560"><span class="hs-identifier">settings</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-103"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadSettings"><span class="hs-identifier hs-var">buildFramePayloadSettings</span></a><span> </span><a href="#local-6989586621679074559"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074560"><span class="hs-identifier hs-var">settings</span></a><span>
</span><a name="line-104"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074561"><a href="#local-6989586621679074561"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#PushPromiseFrame"><span class="hs-identifier hs-var">PushPromiseFrame</span></a><span> </span><a name="local-6989586621679074562"><a href="#local-6989586621679074562"><span class="hs-identifier">sid</span></a></a><span> </span><a name="local-6989586621679074563"><a href="#local-6989586621679074563"><span class="hs-identifier">hdr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadPushPromise"><span class="hs-identifier hs-var">buildFramePayloadPushPromise</span></a><span> </span><a href="#local-6989586621679074561"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074562"><span class="hs-identifier hs-var">sid</span></a><span> </span><a href="#local-6989586621679074563"><span class="hs-identifier hs-var">hdr</span></a><span>
</span><a name="line-106"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074564"><a href="#local-6989586621679074564"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#PingFrame"><span class="hs-identifier hs-var">PingFrame</span></a><span> </span><a name="local-6989586621679074565"><a href="#local-6989586621679074565"><span class="hs-identifier">opaque</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-107"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadPing"><span class="hs-identifier hs-var">buildFramePayloadPing</span></a><span> </span><a href="#local-6989586621679074564"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074565"><span class="hs-identifier hs-var">opaque</span></a><span>
</span><a name="line-108"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074566"><a href="#local-6989586621679074566"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#GoAwayFrame"><span class="hs-identifier hs-var">GoAwayFrame</span></a><span> </span><a name="local-6989586621679074567"><a href="#local-6989586621679074567"><span class="hs-identifier">sid</span></a></a><span> </span><a name="local-6989586621679074568"><a href="#local-6989586621679074568"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679074569"><a href="#local-6989586621679074569"><span class="hs-identifier">debug</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-109"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadGoAway"><span class="hs-identifier hs-var">buildFramePayloadGoAway</span></a><span> </span><a href="#local-6989586621679074566"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074567"><span class="hs-identifier hs-var">sid</span></a><span> </span><a href="#local-6989586621679074568"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679074569"><span class="hs-identifier hs-var">debug</span></a><span>
</span><a name="line-110"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074570"><a href="#local-6989586621679074570"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#WindowUpdateFrame"><span class="hs-identifier hs-var">WindowUpdateFrame</span></a><span> </span><a name="local-6989586621679074571"><a href="#local-6989586621679074571"><span class="hs-identifier">size</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-111"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadWindowUpdate"><span class="hs-identifier hs-var">buildFramePayloadWindowUpdate</span></a><span> </span><a href="#local-6989586621679074570"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074571"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-112"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074572"><a href="#local-6989586621679074572"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#ContinuationFrame"><span class="hs-identifier hs-var">ContinuationFrame</span></a><span> </span><a name="local-6989586621679074573"><a href="#local-6989586621679074573"><span class="hs-identifier">hdr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-113"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadContinuation"><span class="hs-identifier hs-var">buildFramePayloadContinuation</span></a><span> </span><a href="#local-6989586621679074572"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074573"><span class="hs-identifier hs-var">hdr</span></a><span>
</span><a name="line-114"></a><span class="hs-identifier">buildFramePayload</span><span> </span><a name="local-6989586621679074574"><a href="#local-6989586621679074574"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#UnknownFrame"><span class="hs-identifier hs-var">UnknownFrame</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679074575"><a href="#local-6989586621679074575"><span class="hs-identifier">opaque</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-115"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildFramePayloadUnknown"><span class="hs-identifier hs-var">buildFramePayloadUnknown</span></a><span> </span><a href="#local-6989586621679074574"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074575"><span class="hs-identifier hs-var">opaque</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-identifier">buildPadding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span>
</span><a name="line-120"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span>
</span><a name="line-121"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Payload length.</span><span>
</span><a name="line-122"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><a name="buildPadding"><a href="Network.HTTP2.Encode.html#buildPadding"><span class="hs-identifier">buildPadding</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">encodePadding</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074578"><a href="#local-6989586621679074578"><span class="hs-identifier">builder</span></a></a><span> </span><a name="local-6989586621679074579"><a href="#local-6989586621679074579"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679074580"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074578"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-126"></a><span>    </span><a name="local-6989586621679074580"><a href="#local-6989586621679074580"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><a href="#local-6989586621679074579"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621679074576"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074577"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-127"></a><span class="hs-identifier">buildPadding</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">encodePadding</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679074581"><a href="#local-6989586621679074581"><span class="hs-identifier">padding</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074584"><a href="#local-6989586621679074584"><span class="hs-identifier">btarget</span></a></a><span> </span><a name="local-6989586621679074585"><a href="#local-6989586621679074585"><span class="hs-identifier">targetLength</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679074586"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074587"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>    </span><a name="local-6989586621679074586"><a href="#local-6989586621679074586"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><a href="#local-6989586621679074590"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621679074591"><span class="hs-identifier hs-var">newflags</span></a><span> </span><a href="#local-6989586621679074583"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-131"></a><span>    </span><a name="local-6989586621679074587"><a href="#local-6989586621679074587"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074588"><span class="hs-identifier hs-var">b1</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679074584"><span class="hs-identifier hs-var">btarget</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074581"><span class="hs-identifier hs-var">padding</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>    </span><a name="local-6989586621679074588"><a href="#local-6989586621679074588"><span class="hs-identifier">b1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.singleton</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074589"><span class="hs-identifier hs-var">paddingLength</span></a><span>
</span><a name="line-133"></a><span>    </span><a name="local-6989586621679074589"><a href="#local-6989586621679074589"><span class="hs-identifier">paddingLength</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074581"><span class="hs-identifier hs-var">padding</span></a><span>
</span><a name="line-134"></a><span>    </span><a name="local-6989586621679074590"><a href="#local-6989586621679074590"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679074585"><span class="hs-identifier hs-var">targetLength</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679074589"><span class="hs-identifier hs-var">paddingLength</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-135"></a><span>    </span><a name="local-6989586621679074591"><a href="#local-6989586621679074591"><span class="hs-identifier">newflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#setPadded"><span class="hs-identifier hs-var">setPadded</span></a><span> </span><a href="#local-6989586621679074582"><span class="hs-identifier hs-var">encodeFlags</span></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-identifier">buildPriority</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Types.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span>
</span><a name="line-138"></a><a name="buildPriority"><a href="Network.HTTP2.Encode.html#buildPriority"><span class="hs-identifier">buildPriority</span></a></a><span> </span><a href="Network.HTTP2.Types.html#Priority"><span class="hs-identifier hs-var">Priority</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679074595"><span class="hs-identifier hs-var">builder</span></a><span>
</span><a name="line-139"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-140"></a><span>    </span><a name="local-6989586621679074595"><a href="#local-6989586621679074595"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074597"><span class="hs-identifier hs-var">priority</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>    </span><a name="local-6989586621679074596"><a href="#local-6989586621679074596"><span class="hs-identifier">estream</span></a></a><span>
</span><a name="line-142"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679074592"><span class="hs-identifier hs-var">exclusive</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#setExclusive"><span class="hs-identifier hs-var">setExclusive</span></a><span> </span><a href="#local-6989586621679074593"><span class="hs-identifier hs-var">streamDependency</span></a><span>
</span><a name="line-143"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679074593"><span class="hs-identifier hs-var">streamDependency</span></a><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679074597"><a href="#local-6989586621679074597"><span class="hs-identifier">priority</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCreate</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679074598"><a href="#local-6989586621679074598"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679074599"><a href="#local-6989586621679074599"><span class="hs-identifier">esid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074596"><span class="hs-identifier hs-var">estream</span></a><span>
</span><a name="line-146"></a><span>            </span><a name="local-6989586621679074600"><a href="#local-6989586621679074600"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679074594"><span class="hs-identifier hs-var">weight</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-147"></a><span>        </span><span class="hs-identifier hs-var">N.poke32</span><span> </span><a href="#local-6989586621679074599"><span class="hs-identifier hs-var">esid</span></a><span> </span><a href="#local-6989586621679074598"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-148"></a><span>        </span><span class="hs-identifier hs-var">N.poke8</span><span>  </span><a href="#local-6989586621679074600"><span class="hs-identifier hs-var">w</span></a><span>    </span><a href="#local-6989586621679074598"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">buildFramePayloadData</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><a name="buildFramePayloadData"><a href="Network.HTTP2.Encode.html#buildFramePayloadData"><span class="hs-identifier">buildFramePayloadData</span></a></a><span> </span><a name="local-6989586621679074601"><a href="#local-6989586621679074601"><span class="hs-identifier">einfo</span></a></a><span> </span><a name="local-6989586621679074602"><a href="#local-6989586621679074602"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#buildPadding"><span class="hs-identifier hs-var">buildPadding</span></a><span> </span><a href="#local-6989586621679074601"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074603"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-6989586621679074604"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-155"></a><span>    </span><a name="local-6989586621679074603"><a href="#local-6989586621679074603"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074602"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>    </span><a name="local-6989586621679074604"><a href="#local-6989586621679074604"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074602"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-identifier">buildFramePayloadHeaders</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.HTTP2.Types.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#HeaderBlockFragment"><span class="hs-identifier hs-type">HeaderBlockFragment</span></a><span>
</span><a name="line-159"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><a name="buildFramePayloadHeaders"><a href="Network.HTTP2.Encode.html#buildFramePayloadHeaders"><span class="hs-identifier">buildFramePayloadHeaders</span></a></a><span> </span><a name="local-6989586621679074605"><a href="#local-6989586621679074605"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679074606"><a href="#local-6989586621679074606"><span class="hs-identifier">hdr</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-161"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildPadding"><span class="hs-identifier hs-var">buildPadding</span></a><span> </span><a href="#local-6989586621679074605"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074607"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-6989586621679074608"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-162"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-163"></a><span>    </span><a name="local-6989586621679074607"><a href="#local-6989586621679074607"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074606"><span class="hs-identifier hs-var">hdr</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><a name="local-6989586621679074608"><a href="#local-6989586621679074608"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074606"><span class="hs-identifier hs-var">hdr</span></a><span>
</span><a name="line-165"></a><span class="hs-identifier">buildFramePayloadHeaders</span><span> </span><a name="local-6989586621679074609"><a href="#local-6989586621679074609"><span class="hs-identifier">einfo</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679074610"><a href="#local-6989586621679074610"><span class="hs-identifier">pri</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679074611"><a href="#local-6989586621679074611"><span class="hs-identifier">hdr</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-166"></a><span>    </span><a href="Network.HTTP2.Encode.html#buildPadding"><span class="hs-identifier hs-var">buildPadding</span></a><span> </span><a href="#local-6989586621679074614"><span class="hs-identifier hs-var">einfo'</span></a><span> </span><a href="#local-6989586621679074612"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-6989586621679074613"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-167"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-168"></a><span>    </span><a name="local-6989586621679074612"><a href="#local-6989586621679074612"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#buildPriority"><span class="hs-identifier hs-var">buildPriority</span></a><span> </span><a href="#local-6989586621679074610"><span class="hs-identifier hs-var">pri</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074611"><span class="hs-identifier hs-var">hdr</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>    </span><a name="local-6989586621679074613"><a href="#local-6989586621679074613"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074611"><span class="hs-identifier hs-var">hdr</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-170"></a><span>    </span><a name="local-6989586621679074614"><a href="#local-6989586621679074614"><span class="hs-identifier">einfo'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679074609"><span class="hs-identifier hs-var">einfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">encodeFlags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#setPriority"><span class="hs-identifier hs-var">setPriority</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">encodeFlags</span><span> </span><a href="#local-6989586621679074609"><span class="hs-identifier hs-var">einfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-identifier">buildFramePayloadPriority</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#Priority"><span class="hs-identifier hs-type">Priority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><a name="buildFramePayloadPriority"><a href="Network.HTTP2.Encode.html#buildFramePayloadPriority"><span class="hs-identifier">buildFramePayloadPriority</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074618"><a href="#local-6989586621679074618"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074620"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074619"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679074619"><a href="#local-6989586621679074619"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#buildPriority"><span class="hs-identifier hs-var">buildPriority</span></a><span> </span><a href="#local-6989586621679074618"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621679074620"><a href="#local-6989586621679074620"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><span class="hs-number">5</span><span> </span><a href="#local-6989586621679074615"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074616"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-identifier">buildFramePayloadRSTStream</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#ErrorCodeId"><span class="hs-identifier hs-type">ErrorCodeId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><a name="buildFramePayloadRSTStream"><a href="Network.HTTP2.Encode.html#buildFramePayloadRSTStream"><span class="hs-identifier">buildFramePayloadRSTStream</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074624"><a href="#local-6989586621679074624"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074627"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074625"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-181"></a><span>    </span><a name="local-6989586621679074625"><a href="#local-6989586621679074625"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074626"><span class="hs-identifier hs-var">b4</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621679074626"><a href="#local-6989586621679074626"><span class="hs-identifier">b4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">N.bytestring32</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Network.HTTP2.Types.html#fromErrorCodeId"><span class="hs-identifier hs-var">fromErrorCodeId</span></a><span> </span><a href="#local-6989586621679074624"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-183"></a><span>    </span><a name="local-6989586621679074627"><a href="#local-6989586621679074627"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-6989586621679074621"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074622"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-identifier">buildFramePayloadSettings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#SettingsList"><span class="hs-identifier hs-type">SettingsList</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><a name="buildFramePayloadSettings"><a href="Network.HTTP2.Encode.html#buildFramePayloadSettings"><span class="hs-identifier">buildFramePayloadSettings</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074631"><a href="#local-6989586621679074631"><span class="hs-identifier">alist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074636"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074632"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-188"></a><span>    </span><a name="local-6989586621679074632"><a href="#local-6989586621679074632"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074633"><span class="hs-identifier hs-var">settings</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><a name="local-6989586621679074633"><a href="#local-6989586621679074633"><span class="hs-identifier">settings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCreate</span><span> </span><a href="#local-6989586621679074635"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679074637"><a href="#local-6989586621679074637"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679074634"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679074637"><span class="hs-identifier hs-var">ptr</span></a><span> </span><a href="#local-6989586621679074631"><span class="hs-identifier hs-var">alist</span></a><span>
</span><a name="line-190"></a><span>    </span><a name="local-6989586621679074634"><a href="#local-6989586621679074634"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679074638"><a href="#local-6989586621679074638"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679074639"><a href="#local-6989586621679074639"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621679074640"><a href="#local-6989586621679074640"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679074641"><a href="#local-6989586621679074641"><span class="hs-identifier">kvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-192"></a><span>        </span><span class="hs-identifier hs-var">N.poke16</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#fromSettingsKeyId"><span class="hs-identifier hs-var">fromSettingsKeyId</span></a><span> </span><a href="#local-6989586621679074639"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679074638"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-193"></a><span>        </span><span class="hs-identifier hs-var">N.poke32</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074640"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>      </span><a href="#local-6989586621679074638"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-194"></a><span>        </span><a href="#local-6989586621679074634"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074638"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-number">6</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679074641"><span class="hs-identifier hs-var">kvs</span></a><span>
</span><a name="line-195"></a><span>    </span><a name="local-6989586621679074635"><a href="#local-6989586621679074635"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679074631"><span class="hs-identifier hs-var">alist</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-196"></a><span>    </span><a name="local-6989586621679074636"><a href="#local-6989586621679074636"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><a href="#local-6989586621679074635"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621679074628"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074629"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-identifier">buildFramePayloadPushPromise</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#HeaderBlockFragment"><span class="hs-identifier hs-type">HeaderBlockFragment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><a name="buildFramePayloadPushPromise"><a href="Network.HTTP2.Encode.html#buildFramePayloadPushPromise"><span class="hs-identifier">buildFramePayloadPushPromise</span></a></a><span> </span><a name="local-6989586621679074642"><a href="#local-6989586621679074642"><span class="hs-identifier">einfo</span></a></a><span> </span><a name="local-6989586621679074643"><a href="#local-6989586621679074643"><span class="hs-identifier">sid</span></a></a><span> </span><a name="local-6989586621679074644"><a href="#local-6989586621679074644"><span class="hs-identifier">hdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#buildPadding"><span class="hs-identifier hs-var">buildPadding</span></a><span> </span><a href="#local-6989586621679074642"><span class="hs-identifier hs-var">einfo</span></a><span> </span><a href="#local-6989586621679074645"><span class="hs-identifier hs-var">builder</span></a><span> </span><a href="#local-6989586621679074647"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-200"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-201"></a><span>    </span><a name="local-6989586621679074645"><a href="#local-6989586621679074645"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074646"><span class="hs-identifier hs-var">b4</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074644"><span class="hs-identifier hs-var">hdr</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>    </span><a name="local-6989586621679074646"><a href="#local-6989586621679074646"><span class="hs-identifier">b4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">N.bytestring32</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074643"><span class="hs-identifier hs-var">sid</span></a><span>
</span><a name="line-203"></a><span>    </span><a name="local-6989586621679074647"><a href="#local-6989586621679074647"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074644"><span class="hs-identifier hs-var">hdr</span></a><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span class="hs-identifier">buildFramePayloadPing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><a name="buildFramePayloadPing"><a href="Network.HTTP2.Encode.html#buildFramePayloadPing"><span class="hs-identifier">buildFramePayloadPing</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074651"><a href="#local-6989586621679074651"><span class="hs-identifier">odata</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074653"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074652"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-208"></a><span>    </span><a name="local-6989586621679074652"><a href="#local-6989586621679074652"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074651"><span class="hs-identifier hs-var">odata</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>    </span><a name="local-6989586621679074653"><a href="#local-6989586621679074653"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><span class="hs-number">8</span><span> </span><a href="#local-6989586621679074648"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074649"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-identifier">buildFramePayloadGoAway</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#StreamId"><span class="hs-identifier hs-type">StreamId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#ErrorCodeId"><span class="hs-identifier hs-type">ErrorCodeId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><a name="buildFramePayloadGoAway"><a href="Network.HTTP2.Encode.html#buildFramePayloadGoAway"><span class="hs-identifier">buildFramePayloadGoAway</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074657"><a href="#local-6989586621679074657"><span class="hs-identifier">sid</span></a></a><span> </span><a name="local-6989586621679074658"><a href="#local-6989586621679074658"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679074659"><a href="#local-6989586621679074659"><span class="hs-identifier">debug</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074664"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074660"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-214"></a><span>    </span><a name="local-6989586621679074660"><a href="#local-6989586621679074660"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074662"><span class="hs-identifier hs-var">b8</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074659"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621679074661"><a href="#local-6989586621679074661"><span class="hs-identifier">len0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-216"></a><span>    </span><a name="local-6989586621679074662"><a href="#local-6989586621679074662"><span class="hs-identifier">b8</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeCreate</span><span> </span><a href="#local-6989586621679074661"><span class="hs-identifier hs-var">len0</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679074665"><a href="#local-6989586621679074665"><span class="hs-identifier">ptr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-217"></a><span>        </span><span class="hs-identifier hs-var">N.poke32</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074657"><span class="hs-identifier hs-var">sid</span></a><span class="hs-special">)</span><span>  </span><a href="#local-6989586621679074665"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-218"></a><span>        </span><span class="hs-identifier hs-var">N.poke32</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#fromErrorCodeId"><span class="hs-identifier hs-var">fromErrorCodeId</span></a><span> </span><a href="#local-6989586621679074658"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679074665"><span class="hs-identifier hs-var">ptr</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-219"></a><span>    </span><a name="local-6989586621679074663"><a href="#local-6989586621679074663"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679074661"><span class="hs-identifier hs-var">len0</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074659"><span class="hs-identifier hs-var">debug</span></a><span>
</span><a name="line-220"></a><span>    </span><a name="local-6989586621679074664"><a href="#local-6989586621679074664"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><a href="#local-6989586621679074663"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621679074654"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074655"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-identifier">buildFramePayloadWindowUpdate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#WindowSize"><span class="hs-identifier hs-type">WindowSize</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><a name="buildFramePayloadWindowUpdate"><a href="Network.HTTP2.Encode.html#buildFramePayloadWindowUpdate"><span class="hs-identifier">buildFramePayloadWindowUpdate</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074669"><a href="#local-6989586621679074669"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074672"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074670"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-comment">-- fixme: reserve bit</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621679074670"><a href="#local-6989586621679074670"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074671"><span class="hs-identifier hs-var">b4</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>    </span><a name="local-6989586621679074671"><a href="#local-6989586621679074671"><span class="hs-identifier">b4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">N.bytestring32</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679074669"><span class="hs-identifier hs-var">size</span></a><span>
</span><a name="line-228"></a><span>    </span><a name="local-6989586621679074672"><a href="#local-6989586621679074672"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="#local-6989586621679074666"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074667"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-identifier">buildFramePayloadContinuation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP2.Types.html#HeaderBlockFragment"><span class="hs-identifier hs-type">HeaderBlockFragment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><a name="buildFramePayloadContinuation"><a href="Network.HTTP2.Encode.html#buildFramePayloadContinuation"><span class="hs-identifier">buildFramePayloadContinuation</span></a></a><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-var">EncodeInfo</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679074676"><a href="#local-6989586621679074676"><span class="hs-identifier">hdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074679"><span class="hs-identifier hs-var">header</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679074677"><span class="hs-identifier hs-var">builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-233"></a><span>    </span><a name="local-6989586621679074677"><a href="#local-6989586621679074677"><span class="hs-identifier">builder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679074676"><span class="hs-identifier hs-var">hdr</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>    </span><a name="local-6989586621679074678"><a href="#local-6989586621679074678"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679074676"><span class="hs-identifier hs-var">hdr</span></a><span>
</span><a name="line-235"></a><span>    </span><a name="local-6989586621679074679"><a href="#local-6989586621679074679"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-var">FrameHeader</span></a><span> </span><a href="#local-6989586621679074678"><span class="hs-identifier hs-var">len</span></a><span> </span><a href="#local-6989586621679074673"><span class="hs-identifier hs-var">encodeFlags</span></a><span> </span><a href="#local-6989586621679074674"><span class="hs-identifier hs-var">encodeStreamId</span></a><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">buildFramePayloadUnknown</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP2.Encode.html#EncodeInfo"><span class="hs-identifier hs-type">EncodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP2.Types.html#FrameHeader"><span class="hs-identifier hs-type">FrameHeader</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP2.Encode.html#Builder"><span class="hs-identifier hs-type">Builder</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><a name="buildFramePayloadUnknown"><a href="Network.HTTP2.Encode.html#buildFramePayloadUnknown"><span class="hs-identifier">buildFramePayloadUnknown</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP2.Encode.html#buildFramePayloadData"><span class="hs-identifier hs-var">buildFramePayloadData</span></a><span>
</span><a name="line-239"></a></pre></body></html>